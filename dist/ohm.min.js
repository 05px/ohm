!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.ohm=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){var ohm=_dereq_("../src/main.js");ohm._ohmGrammarFactory=function(ohm,optNamespace){var b=ohm._builder();b.setName("Ohm");b.setRuleDescription(undefined);b.define("Grammars",b.many(b.app("Grammar"),0));b.setRuleDescription(undefined);b.define("Grammar",b.seq(b.bind(b.app("ident"),"n"),b.bind(b.opt(b.app("SuperGrammar")),"s"),b.prim("{"),b.bind(b.many(b.app("Rule"),0),"rs"),b.prim("}")));b.inline("SuperGrammar_qualified",b.seq(b.prim("<:"),b.bind(b.app("ident"),"ns"),b.prim("."),b.bind(b.app("ident"),"n")));b.inline("SuperGrammar_unqualified",b.seq(b.prim("<:"),b.bind(b.app("ident"),"n")));b.setRuleDescription(undefined);b.define("SuperGrammar",b.alt(b.app("SuperGrammar_qualified"),b.app("SuperGrammar_unqualified")));b.inline("Rule_define",b.seq(b.bind(b.app("ident"),"n"),b.bind(b.opt(b.app("ruleDescr")),"d"),b.prim("="),b.bind(b.app("Alt"),"b")));b.inline("Rule_override",b.seq(b.bind(b.app("ident"),"n"),b.prim(":="),b.bind(b.app("Alt"),"b")));b.inline("Rule_extend",b.seq(b.bind(b.app("ident"),"n"),b.prim("+="),b.bind(b.app("Alt"),"b")));b.setRuleDescription(undefined);b.define("Rule",b.alt(b.app("Rule_define"),b.app("Rule_override"),b.app("Rule_extend")));b.inline("Alt_rec",b.seq(b.bind(b.app("Term"),"x"),b.prim("|"),b.bind(b.app("Alt"),"y")));b.setRuleDescription(undefined);b.define("Alt",b.alt(b.app("Alt_rec"),b.app("Term")));b.inline("Term_inline",b.seq(b.bind(b.app("Seq"),"x"),b.prim("{"),b.bind(b.app("name"),"n"),b.prim("}")));b.setRuleDescription(undefined);b.define("Term",b.alt(b.app("Term_inline"),b.app("Seq")));b.setRuleDescription(undefined);b.define("Seq",b.many(b.app("Factor"),0));b.inline("Factor_bind",b.seq(b.bind(b.app("Iter"),"x"),b.prim(":"),b.bind(b.app("ident"),"n")));b.setRuleDescription(undefined);b.define("Factor",b.alt(b.app("Factor_bind"),b.app("Iter")));b.inline("Iter_star",b.seq(b.bind(b.app("Pred"),"x"),b.prim("*")));b.inline("Iter_plus",b.seq(b.bind(b.app("Pred"),"x"),b.prim("+")));b.inline("Iter_opt",b.seq(b.bind(b.app("Pred"),"x"),b.prim("?")));b.setRuleDescription(undefined);b.define("Iter",b.alt(b.app("Iter_star"),b.app("Iter_plus"),b.app("Iter_opt"),b.app("Pred")));b.inline("Pred_not",b.seq(b.prim("~"),b.bind(b.app("Base"),"x")));b.inline("Pred_lookahead",b.seq(b.prim("&"),b.bind(b.app("Base"),"x")));b.setRuleDescription(undefined);b.define("Pred",b.alt(b.app("Pred_not"),b.app("Pred_lookahead"),b.app("Base")));b.inline("Base_application",b.seq(b.bind(b.app("ident"),"ruleName"),b.not(b.alt(b.seq(b.opt(b.app("ruleDescr")),b.prim("=")),b.prim(":="),b.prim("+=")))));b.inline("Base_prim",b.alt(b.app("keyword"),b.app("string"),b.app("regExp"),b.app("number")));b.inline("Base_lst",b.seq(b.prim("["),b.bind(b.app("Alt"),"x"),b.prim("]")));b.inline("Base_str",b.seq(b.prim('"'),b.bind(b.app("Alt"),"x"),b.prim('"')));b.inline("Base_paren",b.seq(b.prim("("),b.bind(b.app("Alt"),"x"),b.prim(")")));b.inline("Base_obj",b.seq(b.prim("{"),b.bind(b.opt(b.prim("...")),"lenient"),b.prim("}")));b.inline("Base_objWithProps",b.seq(b.prim("{"),b.bind(b.app("Props"),"ps"),b.bind(b.opt(b.seq(b.prim(","),b.prim("..."))),"lenient"),b.prim("}")));b.setRuleDescription(undefined);b.define("Base",b.alt(b.app("Base_application"),b.app("Base_prim"),b.app("Base_lst"),b.app("Base_str"),b.app("Base_paren"),b.app("Base_obj"),b.app("Base_objWithProps")));b.setRuleDescription(undefined);b.define("Prop",b.seq(b.bind(b.alt(b.app("name"),b.app("string")),"n"),b.prim(":"),b.bind(b.app("Base"),"p")));b.inline("Props_rec",b.seq(b.bind(b.app("Prop"),"p"),b.prim(","),b.bind(b.app("Props"),"ps")));b.inline("Props_base",b.bind(b.app("Prop"),"p"));b.setRuleDescription(undefined);b.define("Props",b.alt(b.app("Props_rec"),b.app("Props_base")));b.setRuleDescription(" rule description for use in error messages");b.define("ruleDescr",b.seq(b.prim("--"),b.bind(b.app("ruleDescrText"),"t"),b.prim("\n")));b.setRuleDescription(undefined);b.define("ruleDescrText",b.many(b.seq(b.not(b.prim("\n")),b.app("_")),0));b.inline("space_singleLine",b.seq(b.prim("//"),b.many(b.seq(b.not(b.prim("\n")),b.app("_")),0),b.prim("\n")));b.inline("space_multiLine",b.seq(b.prim("/*"),b.many(b.seq(b.not(b.prim("*/")),b.app("_")),0),b.prim("*/")));b.extend("space",b.alt(b.app("space_singleLine"),b.app("space_multiLine")));b.setRuleDescription(" name");b.define("name",b.seq(b.app("nameFirst"),b.many(b.app("nameRest"),0)));b.setRuleDescription(undefined);b.define("nameFirst",b.alt(b.prim("_"),b.app("letter")));b.setRuleDescription(undefined);b.define("nameRest",b.alt(b.prim("_"),b.app("alnum")));b.setRuleDescription(" identifier");b.define("ident",b.seq(b.not(b.app("keyword")),b.bind(b.app("name"),"n")));b.inline("keyword_undefined",b.seq(b.prim("undefined"),b.not(b.app("nameRest"))));b.inline("keyword_null",b.seq(b.prim("null"),b.not(b.app("nameRest"))));b.inline("keyword_true",b.seq(b.prim("true"),b.not(b.app("nameRest"))));b.inline("keyword_false",b.seq(b.prim("false"),b.not(b.app("nameRest"))));b.setRuleDescription(undefined);b.define("keyword",b.alt(b.app("keyword_undefined"),b.app("keyword_null"),b.app("keyword_true"),b.app("keyword_false")));b.setRuleDescription(" string literal");b.define("string",b.seq(b.prim("'"),b.bind(b.many(b.app("sChar"),0),"cs"),b.prim("'")));b.setRuleDescription(undefined);b.define("sChar",b.alt(b.seq(b.prim("\\x"),b.app("hexDigit"),b.app("hexDigit")),b.seq(b.prim("\\u"),b.app("hexDigit"),b.app("hexDigit"),b.app("hexDigit"),b.app("hexDigit")),b.seq(b.prim("\\"),b.app("_")),b.seq(b.not(b.prim("'")),b.not(b.prim("\n")),b.app("_"))));b.setRuleDescription(" regular expression");b.define("regExp",b.seq(b.prim("/"),b.bind(b.app("reCharClass"),"e"),b.prim("/")));b.setRuleDescription(undefined);b.define("reCharClass",b.seq(b.prim("["),b.many(b.alt(b.prim("\\]"),b.seq(b.not(b.prim("]")),b.app("_"))),0),b.prim("]")));b.setRuleDescription(" number");b.define("number",b.seq(b.opt(b.prim("-")),b.many(b.app("digit"),1)));return b.build(optNamespace)}},{"../src/main.js":17}],2:[function(_dereq_,module,exports){exports.objectUtils=_dereq_("./objectUtils.js");exports.stringUtils=_dereq_("./stringUtils.js");exports.equals=_dereq_("./equals.js");exports.browser=_dereq_("./browser.js")},{"./browser.js":3,"./equals.js":4,"./objectUtils.js":5,"./stringUtils.js":6}],3:[function(_dereq_,module,exports){var thisModule=exports;var subscribed={};exports.log=function(subject){if(!subscribed[subject])return;arguments[0]="["+subject+"]";console.log.apply(console,arguments)};exports.subscribe=function(subject){subscribed[subject]=true};exports.unsubscribe=function(subject){delete showing[subject]};exports.error=function(){var args=Array.prototype.slice.call(arguments);console.error.apply(console,args);throw"error: "+args.join(" ")};exports.sanityCheck=function(name,condition){if(!condition)thisModule.error("failed sanity check:",name)};exports.prettyPrintNode=function(node,endNode,endOffset){if(node instanceof Text){if(node===endNode)return"text{"+node.data.substr(0,endOffset)+"|"+node.data.substr(endOffset)+"}";else return"text{"+node.data+"}"}var parts=[node.tagName,"{"];for(var idx=0;idx<node.childNodes.length;idx++){if(node===endNode&&endOffset==idx)parts.push("|");parts.push(thisModule.prettyPrintNode(node.childNodes.item(idx),endNode,endOffset))}if(node===endNode&&endOffset==node.childNodes.length)parts.push("|");parts.push("}");return parts.join("")}},{}],4:[function(_dereq_,module,exports){function doubleEquals(x,y){return x==y}function tripleEquals(x,y){return x===y}function isPrimitive(x){var type=typeof x;return type!=="object"}function equals(x,y,deep,eqFn){if(isPrimitive(x))return eqFn(x,y);for(var p in x)if(deep&&!equals(x[p],y[p],deep,eqFn)||!deep&&!eqFn(x[p],y[p]))return false;for(var p in y)if(y[p]!==undefined&&x[p]===undefined)return false;return true}function haveSameContentsInAnyOrder(arr1,arr2,deep,eqFn){if(!arr1 instanceof Array||!arr2 instanceof Array||arr1.length!==arr2.length)return false;for(var idx=0;idx<arr1.length;idx++){var x=arr1[idx];var foundX=arr2.some(function(y){return equals(x,y,deep,eqFn)});if(!foundX)return false}return true}exports.equals=function(x,y){return equals(x,y,false,doubleEquals)};exports.deepEquals=function(x,y){return equals(x,y,true,doubleEquals)};exports.strictEquals=function(x,y){return equals(x,y,false,tripleEquals)};exports.strictDeepEquals=function(x,y){return equals(x,y,true,tripleEquals)};exports.haveSameContentsInAnyOrder=function(arr1,arr2){return haveSameContentsInAnyOrder(arr1,arr2,true,doubleEquals)}},{}],5:[function(_dereq_,module,exports){var thisModule=exports;exports.objectThatDelegatesTo=function(obj,optProperties){function cons(){}cons.prototype=obj;var ans=new cons;if(optProperties)thisModule.keysAndValuesDo(optProperties,function(k,v){ans[k]=v});return ans};exports.formals=function(func){return func.toString().match(/\((.*?)\)/)[0].replace(/ /g,"").slice(1,-1).split(",").filter(function(moduleName){return moduleName!=""})};exports.keysDo=function(object,fn){for(var p in object)if(object.hasOwnProperty(p))fn(p)};exports.valuesDo=function(object,fn){thisModule.keysDo(object,function(p){fn(object[p])})};exports.keysAndValuesDo=function(object,fn){thisModule.keysDo(object,function(p){fn(p,object[p])})};exports.keysIterator=function(object){return function(fn){self.keysDo(object,fn)}};exports.valuesIterator=function(object){return function(fn){self.valuesDo(object,fn)}};exports.keysAndValuesIterator=function(object){return function(fn){self.keysAndValuesDo(object,fn)}};exports.values=function(object){var ans=[];thisModule.keysDo(object,function(p){ans.push(object[p])});return ans};function StringBuffer(){this.strings=[];this.lengthSoFar=0}StringBuffer.prototype={nextPutAll:function(s){this.strings.push(s);this.lengthSoFar+=s.length},contents:function(){return this.strings.join("")}};exports.stringBuffer=function(){return new StringBuffer};function ColumnStringBuffer(){this.lines=[];this.newLine()}ColumnStringBuffer.prototype={nextPutAll:function(s){this.currentColumn().push(s)},contents:function(){var columnLengths=[];this.lines.forEach(function(line){for(var colIdx=0;colIdx<line.length;colIdx++){var column=line[colIdx];line[colIdx]=column.join("");if(columnLengths[colIdx]===undefined||columnLengths[colIdx]<line[colIdx].length)columnLengths[colIdx]=line[colIdx].length}});var sb=thisModule.stringBuffer();this.lines.forEach(function(line){for(var colIdx=0;colIdx<line.length;colIdx++){var column=line[colIdx];sb.nextPutAll(column);var numSpaces=columnLengths[colIdx]-column.length;while(numSpaces-->0)sb.nextPutAll(" ")}sb.nextPutAll("\n")});return sb.contents()},newLine:function(){this.lines.push([]);this.newColumn()},newColumn:function(){this.currentLine().push([])},currentColumn:function(){var line=this.currentLine();return line[line.length-1]},currentLine:function(){return this.lines[this.lines.length-1]}};exports.columnStringBuffer=function(){return new ColumnStringBuffer}},{}],6:[function(_dereq_,module,exports){var objectUtils=_dereq_("./objectUtils.js");var thisModule=exports;function pad(numberAsString,len){var zeros=[];for(var idx=0;idx<numberAsString.length-len;idx++)zeros.push("0");return zeros.join("")+numberAsString}var escapeStringFor={};for(var c=0;c<128;c++)escapeStringFor[c]=String.fromCharCode(c);escapeStringFor["'".charCodeAt(0)]="\\'";escapeStringFor['"'.charCodeAt(0)]='\\"';escapeStringFor["\\".charCodeAt(0)]="\\\\";escapeStringFor["\b".charCodeAt(0)]="\\b";escapeStringFor["\f".charCodeAt(0)]="\\f";escapeStringFor["\n".charCodeAt(0)]="\\n";escapeStringFor["\r".charCodeAt(0)]="\\r";escapeStringFor["	".charCodeAt(0)]="\\t";escapeStringFor["".charCodeAt(0)]="\\v";exports.escapeChar=function(c,optDelim){var charCode=c.charCodeAt(0);if((c=='"'||c=="'")&&optDelim&&c!==optDelim)return c;else if(charCode<128)return escapeStringFor[charCode];else if(128<=charCode&&charCode<256)return"\\x"+pad(charCode.toString(16),2);else return"\\u"+pad(charCode.toString(16),4)};exports.unescapeChar=function(s){if(s.charAt(0)=="\\")switch(s.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"	";case"v":return"";case"x":return String.fromCharCode(parseInt(s.substring(2,4),16));case"u":return String.fromCharCode(parseInt(s.substring(2,6),16));default:return s.charAt(1)}else return s};function printOn(x,ws){if(x instanceof Array){ws.nextPutAll("[");for(var idx=0;idx<x.length;idx++){if(idx>0)ws.nextPutAll(", ");printOn(x[idx],ws)}ws.nextPutAll("]")}else if(typeof x==="string"){var hasSingleQuotes=x.indexOf("'")>=0;var hasDoubleQuotes=x.indexOf('"')>=0;var delim=hasSingleQuotes&&!hasDoubleQuotes?'"':"'";ws.nextPutAll(delim);for(var idx=0;idx<x.length;idx++)ws.nextPutAll(thisModule.escapeChar(x[idx],delim));ws.nextPutAll(delim)}else if(x===null){ws.nextPutAll("null")}else if(typeof x==="object"&&!(x instanceof RegExp)){ws.nextPutAll("{");var first=true;objectUtils.keysAndValuesDo(x,function(k,v){if(first)first=false;else ws.nextPutAll(", ");printOn(k,ws);ws.nextPutAll(": ");printOn(v,ws)});ws.nextPutAll("}")}else ws.nextPutAll(""+x)}exports.printString=function(obj){var ws=objectUtils.stringBuffer();printOn(obj,ws);return ws.contents()}},{"./objectUtils.js":5}],7:[function(_dereq_,module,exports){var Grammar=_dereq_("./Grammar.js");var decls=_dereq_("./decls.js");var pexprs=_dereq_("./pexprs.js");var awlib=_dereq_("awlib");var objectThatDelegatesTo=awlib.objectUtils.objectThatDelegatesTo;function Builder(){this.init()}Builder.prototype={init:function(){this.name=undefined;this.superGrammar=Grammar.prototype;this.ruleDecls=[]},setName:function(name){this.name=name},setSuperGrammar:function(grammar){this.superGrammar=grammar},setRuleDescription:function(text){this.ruleDescription=text},define:function(ruleName,body){this.ruleDecls.push(new decls.Define(ruleName,body,this.superGrammar,this.ruleDescription));this.ruleDescription=undefined},override:function(ruleName,body){this.ruleDecls.push(new decls.Override(ruleName,body,this.superGrammar))},inline:function(ruleName,body){this.ruleDecls.push(new decls.Inline(ruleName,body,this.superGrammar));return this.app(ruleName)},extend:function(ruleName,body){this.ruleDecls.push(new decls.Extend(ruleName,body,this.superGrammar))},build:function(optNamespace){var superGrammar=this.superGrammar;var ruleDict=objectThatDelegatesTo(superGrammar.ruleDict);this.ruleDecls.forEach(function(ruleDecl){ruleDecl.performChecks();ruleDecl.install(ruleDict)});var grammar=new Grammar(ruleDict);grammar.superGrammar=superGrammar;grammar.ruleDecls=this.ruleDecls;if(this.name){grammar.name=this.name;if(optNamespace){grammar.namespaceName=optNamespace.name;optNamespace.install(this.name,grammar)}}this.init();return grammar},prim:function(x){return pexprs.makePrim(x)},alt:function(){var terms=[];for(var idx=0;idx<arguments.length;idx++){var arg=arguments[idx];if(arg instanceof pexprs.Alt){terms=terms.concat(arg.terms)}else{terms.push(arg)}}return terms.length===1?terms[0]:new pexprs.Alt(terms)},seq:function(){var factors=[];for(var idx=0;idx<arguments.length;idx++){var arg=arguments[idx];if(arg instanceof pexprs.Seq){factors=factors.concat(arg.factors)}else{factors.push(arg)}}return factors.length===1?factors[0]:new pexprs.Seq(factors)},bind:function(expr,name){return new pexprs.Bind(expr,name)},many:function(expr,minNumMatches){return new pexprs.Many(expr,minNumMatches)},opt:function(expr){return new pexprs.Opt(expr)},not:function(expr){return new pexprs.Not(expr)},la:function(expr){return new pexprs.Lookahead(expr)},str:function(expr){return new pexprs.Str(expr)},lst:function(expr){return new pexprs.List(expr)},obj:function(properties,isLenient){return new pexprs.Obj(properties,!!isLenient)},app:function(ruleName){return new pexprs.Apply(ruleName)}};module.exports=Builder},{"./Grammar.js":8,"./decls.js":15,"./pexprs.js":27,awlib:2}],8:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var errors=_dereq_("./errors.js");var InputStream=_dereq_("./InputStream.js");var MatchFailure=_dereq_("./MatchFailure.js");var pexprs=_dereq_("./pexprs.js");var skipSpaces=_dereq_("./skipSpaces.js");var awlib=_dereq_("awlib");var browser=awlib.browser;var keysDo=awlib.objectUtils.keysDo;var valuesDo=awlib.objectUtils.valuesDo;var formals=awlib.objectUtils.formals;var makeStringBuffer=awlib.objectUtils.stringBuffer;var makeColumnStringBuffer=awlib.objectUtils.columnStringBuffer;var printString=awlib.stringUtils.printString;var equals=awlib.equals.equals;function Grammar(ruleDict){this.ruleDict=ruleDict}Grammar.prototype={ruleDict:new function(){this._=pexprs.anything;this.end=new pexprs.Not(pexprs.anything);this.space=pexprs.makePrim(/[\s]/);this.space.description="space";this.spaces=new pexprs.Alt([new pexprs.Seq([new pexprs.Apply("spaces"),new pexprs.Apply("space")]),new pexprs.Seq([])]);this.alnum=pexprs.makePrim(/[0-9a-zA-Z]/);this.space.description="alpha-numeric character";this.letter=pexprs.makePrim(/[a-zA-Z]/);this.letter.description="letter";this.lower=pexprs.makePrim(/[a-z]/);this.lower.description="lower-case letter";this.upper=pexprs.makePrim(/[A-Z]/);this.upper.description="upper-case letter";this.digit=pexprs.makePrim(/[0-9]/);this.digit.description="digit";this.hexDigit=pexprs.makePrim(/[0-9a-fA-F]/);this.hexDigit.description="hexadecimal digit"},match:function(obj,startRule,optThrowOnFail){return this.matchContents([obj],startRule,optThrowOnFail)},matchContents:function(obj,startRule,optThrowOnFail){var inputStream=InputStream.newFor(obj);var thunk=new pexprs.Apply(startRule).eval(optThrowOnFail,undefined,this.ruleDict,inputStream,undefined);var succeeded;if(thunk===common.fail){succeeded=false}else{if(common.isSyntactic(startRule)){skipSpaces(this.ruleDict,inputStream)}succeeded=pexprs.end.eval(optThrowOnFail,false,this.ruleDict,inputStream,undefined)!==common.fail}if(succeeded){var assertSemanticActionNamesMatch=this.assertSemanticActionNamesMatch.bind(this);var ans=function(actionDict){assertSemanticActionNamesMatch(actionDict);return thunk.force(actionDict,{})};ans.toString=function(){return"[ohm thunk]"};return ans}else if(optThrowOnFail){throw new MatchFailure(inputStream,this.ruleDict)}else{return false}},assertSemanticActionNamesMatch:function(actionDict){var self=this;var ruleDict=this.ruleDict;var ok=true;keysDo(ruleDict,function(ruleName){if(actionDict[ruleName]===undefined){return}var actual=formals(actionDict[ruleName]).sort();var expected=self.semanticActionArgNames(ruleName);if(!equals(actual,expected)){ok=false;console.log("semantic action for rule",ruleName,"has the wrong argument names");console.log("  expected",expected);console.log("    actual",actual)}});if(!ok){browser.error("one or more semantic actions have the wrong argument names -- see console for details")}},semanticActionArgNames:function(ruleName){if(this.superGrammar&&this.superGrammar.ruleDict[ruleName]){return this.superGrammar.semanticActionArgNames(ruleName)}else{var body=this.ruleDict[ruleName];var names=body.getBindingNames();return names.length>0||body.producesValue()?["env"]:[]}},toRecipe:function(){var ws=makeStringBuffer();ws.nextPutAll("(function(ohm, optNamespace) {\n");ws.nextPutAll("  var b = ohm._builder();\n");ws.nextPutAll("  b.setName(");ws.nextPutAll(printString(this.name));ws.nextPutAll(");\n");if(this.superGrammar.name&&this.superGrammar.namespaceName){ws.nextPutAll("  b.setSuperGrammar(ohm.namespace(");ws.nextPutAll(printString(this.superGrammar.namespaceName));ws.nextPutAll(").getGrammar(");ws.nextPutAll(printString(this.superGrammar.name));ws.nextPutAll("));\n")}for(var idx=0;idx<this.ruleDecls.length;idx++){ws.nextPutAll("  ");this.ruleDecls[idx].outputRecipe(ws);ws.nextPutAll(";\n")}ws.nextPutAll("  return b.build(optNamespace);\n");ws.nextPutAll("});");return ws.contents()},toSemanticActionTemplate:function(){var entryPoints=arguments.length>0?arguments:Object.keys(this.ruleDict);var rulesToBeIncluded=this.rulesThatNeedSemanticAction(entryPoints);var self=this;var buffer=makeColumnStringBuffer();buffer.nextPutAll("{");var first=true;for(var ruleName in rulesToBeIncluded){var body=this.ruleDict[ruleName];if(first){first=false}else{buffer.nextPutAll(",")}buffer.newLine();buffer.nextPutAll("  ");buffer.newColumn();self.addSemanticActionTemplate(ruleName,body,buffer)}buffer.newLine();buffer.nextPutAll("}");return buffer.contents()},addSemanticActionTemplate:function(ruleName,body,buffer){buffer.nextPutAll(ruleName);buffer.nextPutAll(": ");buffer.newColumn();buffer.nextPutAll("function(");buffer.nextPutAll(this.semanticActionArgNames(ruleName).join(", "));buffer.nextPutAll(") ");buffer.newColumn();buffer.nextPutAll("{");var envProperties=body.getBindingNames();if(envProperties.length===0&&body.producesValue()){envProperties=["value"]}if(envProperties.length>0){buffer.nextPutAll(" /* ");buffer.nextPutAll(envProperties.join(", "));buffer.nextPutAll(" */ ")}buffer.nextPutAll("}")},rulesThatNeedSemanticAction:function(entryPoints){var self=this;function getBody(ruleName){if(self.ruleDict[ruleName]===undefined){throw new errors.UndeclaredRuleError(ruleName,self.name)}else{return self.ruleDict[ruleName]}}var rules={};for(var idx=0;idx<entryPoints.length;idx++){var ruleName=entryPoints[idx];getBody(ruleName);rules[ruleName]=true}var done=false;while(!done){done=true;for(var ruleName in rules){var addedNewRule=getBody(ruleName).addRulesThatNeedSemanticAction(rules,true);done&=!addedNewRule}}return rules}};module.exports=Grammar},{"./InputStream.js":9,"./MatchFailure.js":11,"./common.js":14,"./errors.js":16,"./pexprs.js":27,"./skipSpaces.js":28,awlib:2}],9:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var PosInfo=_dereq_("./PosInfo.js");var Grammar=_dereq_("./Grammar.js");var awlib=_dereq_("awlib");var objectThatDelegatesTo=awlib.objectUtils.objectThatDelegatesTo;function InputStream(){throw"InputStream cannot be instantiated -- it's abstract"}InputStream.newFor=function(obj){if(typeof obj==="string"){return new StringInputStream(obj)}else if(obj instanceof Array){return new ListInputStream(obj)}else{throw"cannot make input stream for "+obj}};InputStream.prototype={init:function(source){this.source=source;this.pos=0;this.posInfos=[];this.failures=null;this.failuresPos=-1},recordFailure:function(pos,expr){if(pos>this.failuresPos){this.failures={expr:expr,next:null};this.failuresPos=pos}else if(pos===this.failuresPos){this.failures={expr:expr,next:this.failures}}},getCurrentPosInfo:function(){var currPos=this.pos;var posInfo=this.posInfos[currPos];return posInfo||(this.posInfos[currPos]=new PosInfo(currPos))},atEnd:function(){return this.pos===this.source.length},next:function(){if(this.atEnd()){return common.fail}else{return this.source[this.pos++]}},matchExactly:function(x){return this.next()===x?true:common.fail},interval:function(startIdx,endIdx){return this.source.slice(startIdx,endIdx)},getFailuresPos:function(){return this.failuresPos}};function StringInputStream(source){this.init(source)}StringInputStream.prototype=objectThatDelegatesTo(InputStream.prototype,{matchString:function(s){for(var idx=0;idx<s.length;idx++){if(this.matchExactly(s[idx])===common.fail){return common.fail}}return true},matchRegExp:function(e){var c=this.next();return c!==common.fail&&e.test(c)?true:common.fail}});function ListInputStream(source){this.init(source)}ListInputStream.prototype=objectThatDelegatesTo(InputStream.prototype,{matchString:function(s){return this.matchExactly(s)},matchRegExp:function(e){return this.matchExactly(e)}});module.exports=InputStream},{"./Grammar.js":8,"./PosInfo.js":13,"./common.js":14,awlib:2}],10:[function(_dereq_,module,exports){var InputStream=_dereq_("./InputStream.js");function Interval(source,startIdx,endIdx){this.source=source;this.startIdx=startIdx;this.endIdx=endIdx}Object.defineProperties(Interval.prototype,{contents:{get:function(){if(this._contents===undefined){this._contents=InputStream.newFor(this.source).interval(this.startIdx,this.endIdx)}return this._contents},enumerable:true}});module.exports=Interval},{"./InputStream.js":9}],11:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var awlib=_dereq_("awlib");var makeStringBuffer=awlib.objectUtils.stringBuffer;var printString=awlib.stringUtils.printString;function toErrorInfo(pos,str){var lineNum=1;var colNum=1;var currPos=0;var lineStartPos=0;while(currPos<pos){var c=str.charAt(currPos++);if(c==="\n"){lineNum++;colNum=1;lineStartPos=currPos}else if(c!=="\r"){colNum++}}var lineEndPos=str.indexOf("\n",lineStartPos);if(lineEndPos<0){lineEndPos=str.length}return{lineNum:lineNum,colNum:colNum,line:str.substr(lineStartPos,lineEndPos-lineStartPos)}}function MatchFailure(inputStream,ruleDict){this.inputStream=inputStream;this.ruleDict=ruleDict}MatchFailure.prototype.getPos=function(){return this.inputStream.failuresPos};MatchFailure.prototype.toString=function(){if(typeof this.inputStream.source!=="string"){return"error at position "+this.getPos()}else{var text=makeStringBuffer();var errorInfo=toErrorInfo(this.getPos(),this.inputStream.source);text.nextPutAll(this.getLineAndColText());text.nextPutAll(": expected ");text.nextPutAll(this.getExpectedText());return text.contents()}};MatchFailure.prototype.getExtendedErrorMessage=function(){if(typeof this.inputStream.source!=="string"){return"error at position "+this.getPos()}else{var text=makeStringBuffer();var errorInfo=toErrorInfo(this.getPos(),this.inputStream.source);var lineAndColText=this.getLineAndColText()+": ";text.nextPutAll(lineAndColText);text.nextPutAll(errorInfo.line);text.nextPutAll("\n");for(var idx=1;idx<lineAndColText.length+errorInfo.colNum;idx++){text.nextPutAll(" ")}text.nextPutAll("^")}text.nextPutAll("\nExpected: ");text.nextPutAll(this.getExpectedText());return text.contents()};MatchFailure.prototype.printExtendedErrorMessage=function(){console.log(this.getExtendedErrorMessage())};MatchFailure.prototype.getLineAndColText=function(){var errorInfo=toErrorInfo(this.getPos(),this.inputStream.source);return"Line "+errorInfo.lineNum+", col "+errorInfo.colNum};MatchFailure.prototype.getExpectedText=function(){var text=makeStringBuffer();var expected=this.getExpectedExprs();for(var idx=0;idx<expected.length;idx++){if(idx>0){if(idx===expected.length-1){text.nextPutAll(expected.length>2?", or ":" or ")}else{text.nextPutAll(", ")}}text.nextPutAll(expected[idx])}return text.contents()};MatchFailure.prototype.getExpectedExprs=function(){var expected={};for(var failure=this.inputStream.failures;failure!==null;failure=failure.next){expected[failure.expr.toExpected(this.ruleDict)]=true}return Object.keys(expected).reverse()};module.exports=MatchFailure},{"./common.js":14,awlib:2}],12:[function(_dereq_,module,exports){var ohm=_dereq_("./main.js");var errors=_dereq_("./errors.js");var awlib=_dereq_("awlib");var browser=awlib.browser;function Namespace(name){this.name=name;this.grammars={}}Namespace.prototype={install:function(name,grammar){if(this.grammars[name]){throw new errors.DuplicateGrammarDeclarationError(name,this.name)}else{this.grammars[name]=grammar}return this},getGrammar:function(name){if(this.grammars[name]){return this.grammars[name]}else{throw new errors.UndeclaredGrammarError(name,this.name)}},loadGrammarsFromScriptElement:function(element){browser.sanityCheck('script tag\'s type attribute must be "text/ohm-js"',element.type==="text/ohm-js");ohm.makeGrammars(element.innerHTML,this);return this},make:function(recipe){return recipe(ohm,this)}};module.exports=Namespace},{"./errors.js":16,"./main.js":17,awlib:2}],13:[function(_dereq_,module,exports){var common=_dereq_("./common.js");function PosInfo(){this.ruleStack=[];this.activeRules={};this.memo={}}PosInfo.prototype={isActive:function(ruleName){return this.activeRules[ruleName]},enter:function(ruleName){this.ruleStack.push(ruleName);this.activeRules[ruleName]=true},exit:function(ruleName){this.ruleStack.pop();this.activeRules[ruleName]=false},shouldUseMemoizedResult:function(memoRec){var involvedRules=memoRec.involvedRules;for(var ruleName in involvedRules){if(involvedRules[ruleName]&&this.activeRules[ruleName]){return false}}return true},getCurrentLeftRecursion:function(){return this.leftRecursionStack?this.leftRecursionStack[this.leftRecursionStack.length-1]:undefined},startLeftRecursion:function(ruleName){if(!this.leftRecursionStack){this.leftRecursionStack=[]}this.leftRecursionStack.push({name:ruleName,value:common.fail,pos:-1,involvedRules:{}});this.updateInvolvedRules()},endLeftRecursion:function(ruleName){this.leftRecursionStack.pop()},updateInvolvedRules:function(){var currentLeftRecursion=this.getCurrentLeftRecursion();var involvedRules=currentLeftRecursion.involvedRules;var lrRuleName=currentLeftRecursion.name;var idx=this.ruleStack.length-1;while(true){var ruleName=this.ruleStack[idx--];if(ruleName===lrRuleName){break}involvedRules[ruleName]=true}}};module.exports=PosInfo},{"./common.js":14}],14:[function(_dereq_,module,exports){exports.abstract=function(){throw"this method is abstract!"};exports.getDuplicates=function(array){var duplicates=[];for(var idx=0;idx<array.length;idx++){var x=array[idx];if(array.lastIndexOf(x)!==idx&&duplicates.indexOf(x)<0){duplicates.push(x)}}return duplicates};exports.fail={};exports.isSyntactic=function(ruleName){var firstChar=ruleName[0];return"A"<=firstChar&&firstChar<="Z"}},{}],15:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var pexprs=_dereq_("./pexprs.js");var errors=_dereq_("./errors.js");var awlib=_dereq_("awlib");var objectThatDelegatesTo=awlib.objectUtils.objectThatDelegatesTo;var printString=awlib.stringUtils.printString;function outputRecipe(decl,ws){ws.nextPutAll("b.");ws.nextPutAll(decl.kind);ws.nextPutAll("(");ws.nextPutAll(printString(decl.name));ws.nextPutAll(", ");decl.body.outputRecipe(ws);ws.nextPutAll(")")}function RuleDecl(){throw"RuleDecl cannot be instantiated -- it's abstract"}RuleDecl.prototype={performChecks:common.abstract,performCommonChecks:function(name,body){body.assertNoDuplicateBindings(name);body.assertNoUselessBindings(name);body.assertChoicesHaveUniformBindings(name)},install:common.abstract,outputRecipe:function(ws){outputRecipe(this,ws)}};function Define(name,body,superGrammar,description){this.name=name;this.body=body;this.superGrammar=superGrammar;this.description=description}Define.prototype=objectThatDelegatesTo(RuleDecl.prototype,{kind:"define",performChecks:function(){if(this.superGrammar.ruleDict[this.name]){throw new errors.DuplicateRuleDeclarationError(this.name,this.superGrammar.name)}this.performCommonChecks(this.name,this.body)},outputRecipe:function(ws){ws.nextPutAll("b.setRuleDescription(");ws.nextPutAll(printString(this.description));ws.nextPutAll("); ");outputRecipe(this,ws)},install:function(ruleDict){this.body.description=this.description;ruleDict[this.name]=this.body}});function Override(name,body,superGrammar){this.name=name;this.body=body;this.superGrammar=superGrammar}Override.prototype=objectThatDelegatesTo(RuleDecl.prototype,{kind:"override",performChecks:function(){var overridden=this.superGrammar.ruleDict[this.name];if(!overridden){throw new errors.UndeclaredRuleError(this.name,this.superGrammar.name)}if(overridden.getBindingNames().length===0&&overridden.producesValue()&&!this.body.producesValue()){throw new errors.RuleMustProduceValueError(this.name,"overriding")
}this.performCommonChecks(this.name,this.body)},install:function(ruleDict){this.body.description=this.superGrammar.ruleDict[this.name].description;ruleDict[this.name]=this.body}});function Inline(name,body,superGrammar){this.name=name;this.body=body;this.superGrammar=superGrammar}Inline.prototype=objectThatDelegatesTo(RuleDecl.prototype,{kind:"inline",performChecks:function(){if(this.superGrammar.ruleDict[this.name]){throw new errors.DuplicateRuleDeclarationError(this.name,this.superGrammar.name)}this.performCommonChecks(this.name,this.body)},install:function(ruleDict){ruleDict[this.name]=this.body}});function Extend(name,body,superGrammar){this.name=name;this.base=superGrammar.ruleDict[name];if(!this.base){throw new errors.UndeclaredRuleError(name,superGrammar.name)}this.body=body;this.extendedBody=new pexprs.ExtendAlt(this.body,this.base);this.superGrammar=superGrammar}Extend.prototype=objectThatDelegatesTo(RuleDecl.prototype,{kind:"extend",performChecks:function(){if(this.base.getBindingNames().length===0&&this.base.producesValue()&&!this.body.producesValue()){throw new errors.RuleMustProduceValueError(this.name,"extending")}this.performCommonChecks(this.name,this.extendedBody)},install:function(ruleDict){this.extendedBody.description=this.superGrammar.ruleDict[this.name].description;ruleDict[this.name]=this.extendedBody}});exports.RuleDecl=RuleDecl;exports.Define=Define;exports.Override=Override;exports.Inline=Inline;exports.Extend=Extend},{"./common.js":14,"./errors.js":16,"./pexprs.js":27,awlib:2}],16:[function(_dereq_,module,exports){exports.UndeclaredGrammarError=function(grammarName,optNamespaceName){this.grammarName=grammarName;this.namespaceName=optNamespaceName};exports.UndeclaredGrammarError.prototype.toString=function(){return this.namespaceName?["grammar",this.grammarName,"is not declared in namespace",this.namespaceName].join(" "):["undeclared grammar",this.grammarName].join(" ")};exports.DuplicateGrammarDeclarationError=function(grammarName,namespaceName){this.grammarName=grammarName;this.namespaceName=namespaceName};exports.DuplicateGrammarDeclarationError.prototype.toString=function(){return["grammar",this.grammarName,"is already declared in namespace",this.namespaceName].join(" ")};exports.UndeclaredRuleError=function(ruleName,optGrammarName){this.ruleName=ruleName;this.grammarName=optGrammarName};exports.UndeclaredRuleError.prototype.toString=function(){return this.grammarName?["rule",this.ruleName,"is not declared in grammar",this.grammarName].join(" "):["undeclared rule",this.ruleName].join(" ")};exports.DuplicateRuleDeclarationError=function(ruleName,grammarName){this.ruleName=ruleName;this.grammarName=grammarName};exports.DuplicateRuleDeclarationError.prototype.toString=function(){return["rule",this.ruleName,"is already declared in grammar",this.grammarName].join(" ")};exports.RuleMustProduceValueError=function(ruleName,why){this.ruleName=ruleName;this.why=why};exports.RuleMustProduceValueError.prototype.toString=function(){return["rule",this.ruleName,"must produce a value","because the rule it is",this.why,"also produces a value"].join(" ")};exports.InconsistentBindingsError=function(ruleName,expected,actual){this.ruleName=ruleName;this.expected=expected;this.actual=actual};exports.InconsistentBindingsError.prototype.toString=function(){return["rule",this.ruleName,"has inconsistent bindings.","expected:",this.expected,"got:",this.actual].join(" ")};exports.DuplicateBindingsError=function(ruleName,duplicates){this.ruleName=ruleName;this.duplicates=duplicates};exports.DuplicateBindingsError.prototype.toString=function(){return["rule",this.ruleName,"has duplicate bindings:",this.duplicates].join(" ")};exports.UselessBindingsError=function(ruleName,useless){this.ruleName=ruleName;this.useless=useless};exports.UselessBindingsError.prototype.toString=function(){return["rule",this.ruleName,"has useless bindings:",this.useless].join(" ")};exports.DuplicatePropertyNamesError=function(duplicates){this.duplicates=duplicates};exports.DuplicatePropertyNamesError.prototype.toString=function(){return["object pattern has duplicate property names:",this.duplicates].join(" ")}},{}],17:[function(_dereq_,module,exports){_dereq_("../dist/ohm-grammar.js");var Builder=_dereq_("./Builder.js");var Namespace=_dereq_("./Namespace.js");var MatchFailure=_dereq_("./MatchFailure.js");var errors=_dereq_("./errors.js");var awlib=_dereq_("awlib");var unescapeChar=awlib.stringUtils.unescapeChar;var thisModule=exports;function makeGrammarActionDict(optNamespace){var builder;return{space:function(env){},space_multiLine:function(){},space_singleLine:function(){},ruleDescr:function(env){builder.setRuleDescription(env.t)},ruleDescrText:function(env){return this.interval.contents},name:function(){return this.interval.contents},nameFirst:function(env){},nameRest:function(env){},ident:function(env){return env.n},keyword:function(env){return env.value},keyword_undefined:function(){return undefined},keyword_null:function(){return null},keyword_true:function(){return true},keyword_false:function(){return false},string:function(env){return env.cs.map(function(c){return unescapeChar(c)}).join("")},sChar:function(){return this.interval.contents},regExp:function(env){return new RegExp(env.e)},reCharClass:function(){return this.interval.contents},number:function(){return parseInt(this.interval.contents)},Alt:function(env){return env.value},Alt_rec:function(env){return builder.alt(env.x,env.y)},Term:function(env){return env.value},Term_inline:function(env){return builder.inline(builder.currentRuleName+"_"+env.n,env.x)},Seq:function(env){return builder.seq.apply(builder,env.value)},Factor:function(env){return env.value},Factor_bind:function(env){return builder.bind(env.x,env.n)},Iter:function(env){return env.value},Iter_star:function(env){return builder.many(env.x,0)},Iter_plus:function(env){return builder.many(env.x,1)},Iter_opt:function(env){return builder.opt(env.x)},Pred:function(env){return env.value},Pred_not:function(env){return builder.not(env.x)},Pred_lookahead:function(env){return builder.la(env.x)},Base:function(env){return env.value},Base_undefined:function(){return builder.prim(undefined)},Base_null:function(){return builder.prim(null)},Base_true:function(){return builder.prim(true)},Base_false:function(){return builder.prim(false)},Base_application:function(env){return builder.app(env.ruleName)},Base_prim:function(env){return builder.prim(env.value)},Base_lst:function(env){return builder.lst(env.x)},Base_str:function(env){return builder.str(env.x)},Base_paren:function(env){return env.x},Base_obj:function(env){return builder.obj([],env.lenient.length>0)},Base_objWithProps:function(env){return builder.obj(env.ps,env.lenient.length>0)},Props:function(env){return env.value},Props_base:function(env){return[env.p]},Props_rec:function(env){return[env.p].concat(env.ps)},Prop:function(env){return{name:env.n,pattern:env.p}},Rule:function(env){return env.value},Rule_define:function(env){builder.currentRuleName=env.n;env.d;return builder.define(env.n,env.b)},Rule_override:function(env){builder.currentRuleName=env.n;env.d;return builder.override(env.n,env.b)},Rule_extend:function(env){builder.currentRuleName=env.n;env.d;return builder.extend(env.n,env.b)},SuperGrammar:function(env){builder.setSuperGrammar(env.value)},SuperGrammar_qualified:function(env){return thisModule.namespace(env.ns).getGrammar(env.n)},SuperGrammar_unqualified:function(env){if(optNamespace){return optNamespace.getGrammar(env.n)}else{throw new errors.UndeclaredGrammarError(env.n)}},Grammar:function(env){builder=new Builder;builder.setName(env.n);env.s;env.rs;return builder.build(optNamespace)},Grammars:function(env){return env.value}}}function compileAndLoad(source,whatItIs,optNamespace){try{var thunk=thisModule._ohmGrammar.matchContents(source,whatItIs,true);return thunk(makeGrammarActionDict(optNamespace))}catch(e){if(e instanceof MatchFailure){console.log("\n"+e.getExtendedErrorMessage())}throw e}}function makeGrammar(source,optNamespace){return compileAndLoad(source,"Grammar",optNamespace)}function makeGrammars(source,optNamespace){return compileAndLoad(source,"Grammars",optNamespace)}var namespaces={};exports.namespace=function(name){if(namespaces[name]===undefined){namespaces[name]=new Namespace(name)}return namespaces[name]};exports.make=function(recipe){return recipe(thisModule)};exports.makeGrammar=makeGrammar;exports.makeGrammars=makeGrammars;exports._builder=function(){return new Builder};exports._makeGrammarActionDict=makeGrammarActionDict;var ohmGrammar;Object.defineProperty(exports,"_ohmGrammar",{get:function(){if(!ohmGrammar){ohmGrammar=this._ohmGrammarFactory(this)}return ohmGrammar}})},{"../dist/ohm-grammar.js":1,"./Builder.js":7,"./MatchFailure.js":11,"./Namespace.js":12,"./errors.js":16,awlib:2}],18:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var pexprs=_dereq_("./pexprs.js");pexprs.PExpr.prototype.addRulesThatNeedSemanticAction=common.abstract;pexprs.anything.addRulesThatNeedSemanticAction=function(){};pexprs.end.addRulesThatNeedSemanticAction=function(){};pexprs.Prim.prototype.addRulesThatNeedSemanticAction=function(){};pexprs.Alt.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){var ans=false;for(var idx=0;idx<this.terms.length;idx++){var term=this.terms[idx];ans|=term.addRulesThatNeedSemanticAction(dict,valueRequired)}return ans};pexprs.Seq.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){var ans=false;for(var idx=0;idx<this.factors.length;idx++){var factor=this.factors[idx];ans|=factor.addRulesThatNeedSemanticAction(dict,false)}return ans};pexprs.Bind.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){return this.expr.addRulesThatNeedSemanticAction(dict,true)};pexprs.Many.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){return this.expr.addRulesThatNeedSemanticAction(dict,valueRequired)};pexprs.Opt.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){return this.expr.addRulesThatNeedSemanticAction(dict,valueRequired)};pexprs.Not.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){return this.expr.addRulesThatNeedSemanticAction(dict,false)};pexprs.Lookahead.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){return this.expr.addRulesThatNeedSemanticAction(dict,valueRequired)};pexprs.Str.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){return this.expr.addRulesThatNeedSemanticAction(dict,false)};pexprs.List.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){return this.expr.addRulesThatNeedSemanticAction(dict,false)};pexprs.Obj.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){return this.expr.addRulesThatNeedSemanticAction(dict,false)};pexprs.Apply.prototype.addRulesThatNeedSemanticAction=function(dict,valueRequired){if(!valueRequired||dict[this.ruleName]){return false}else{return dict[this.ruleName]=true}}},{"./common.js":14,"./pexprs.js":27}],19:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var pexprs=_dereq_("./pexprs.js");var errors=_dereq_("./errors.js");var awlib=_dereq_("awlib");var equals=awlib.equals.equals;pexprs.PExpr.prototype.assertChoicesHaveUniformBindings=common.abstract;pexprs.anything.assertChoicesHaveUniformBindings=function(ruleName){};pexprs.end.assertChoicesHaveUniformBindings=function(ruleName){};pexprs.Prim.prototype.assertChoicesHaveUniformBindings=function(ruleName){};pexprs.Alt.prototype.assertChoicesHaveUniformBindings=function(ruleName){if(this.terms.length===0){return}var names=this.terms[0].getBindingNames();for(var idx=0;idx<this.terms.length;idx++){var term=this.terms[idx];term.assertChoicesHaveUniformBindings();var otherNames=term.getBindingNames();if(!equals(names,otherNames)){throw new errors.InconsistentBindingsError(ruleName,names,otherNames)}}};pexprs.ExtendAlt.prototype.assertChoicesHaveUniformBindings=function(ruleName){var names=this.terms[1].getBindingNames();var otherNames=this.terms[0].getBindingNames();if(!equals(names,otherNames)){throw new errors.InconsistentBindingsError(ruleName,names,otherNames)}};pexprs.Seq.prototype.assertChoicesHaveUniformBindings=function(ruleName){for(var idx=0;idx<this.factors.length;idx++){this.factors[idx].assertChoicesHaveUniformBindings(ruleName)}};pexprs.Bind.prototype.assertChoicesHaveUniformBindings=function(ruleName){this.expr.assertChoicesHaveUniformBindings(ruleName)};pexprs.Many.prototype.assertChoicesHaveUniformBindings=function(ruleName){this.expr.assertChoicesHaveUniformBindings(ruleName)};pexprs.Opt.prototype.assertChoicesHaveUniformBindings=function(ruleName){this.expr.assertChoicesHaveUniformBindings(ruleName)};pexprs.Not.prototype.assertChoicesHaveUniformBindings=function(ruleName){this.expr.assertChoicesHaveUniformBindings(ruleName)};pexprs.Lookahead.prototype.assertChoicesHaveUniformBindings=function(ruleName){this.expr.assertChoicesHaveUniformBindings(ruleName)};pexprs.Str.prototype.assertChoicesHaveUniformBindings=function(ruleName){this.expr.assertChoicesHaveUniformBindings(ruleName)};pexprs.List.prototype.assertChoicesHaveUniformBindings=function(ruleName){this.expr.assertChoicesHaveUniformBindings(ruleName)};pexprs.Obj.prototype.assertChoicesHaveUniformBindings=function(ruleName){for(var idx=0;idx<this.properties.length;idx++){this.properties[idx].pattern.assertChoicesHaveUniformBindings(ruleName)}};pexprs.Apply.prototype.assertChoicesHaveUniformBindings=function(ruleName){}},{"./common.js":14,"./errors.js":16,"./pexprs.js":27,awlib:2}],20:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var pexprs=_dereq_("./pexprs.js");var errors=_dereq_("./errors.js");pexprs.PExpr.prototype.assertNoDuplicateBindings=common.abstract;pexprs.anything.assertNoDuplicateBindings=function(ruleName){};pexprs.end.assertNoDuplicateBindings=function(ruleName){};pexprs.Prim.prototype.assertNoDuplicateBindings=function(ruleName){};pexprs.Alt.prototype.assertNoDuplicateBindings=function(ruleName){for(var idx=0;idx<this.terms.length;idx++){this.terms[idx].assertNoDuplicateBindings(ruleName)}};pexprs.Seq.prototype.assertNoDuplicateBindings=function(ruleName){for(var idx=0;idx<this.factors.length;idx++){this.factors[idx].assertNoDuplicateBindings(ruleName)}var duplicates=common.getDuplicates(this.getBindingNames());if(duplicates.length>0){throw new errors.DuplicateBindingsError(ruleName,duplicates)}};pexprs.Bind.prototype.assertNoDuplicateBindings=function(ruleName){this.expr.assertNoDuplicateBindings(ruleName)};pexprs.Many.prototype.assertNoDuplicateBindings=function(ruleName){this.expr.assertNoDuplicateBindings(ruleName)};pexprs.Opt.prototype.assertNoDuplicateBindings=function(ruleName){this.expr.assertNoDuplicateBindings(ruleName)};pexprs.Not.prototype.assertNoDuplicateBindings=function(ruleName){this.expr.assertNoDuplicateBindings(ruleName)};pexprs.Lookahead.prototype.assertNoDuplicateBindings=function(ruleName){this.expr.assertNoDuplicateBindings(ruleName)};pexprs.Str.prototype.assertNoDuplicateBindings=function(ruleName){this.expr.assertNoDuplicateBindings(ruleName)};pexprs.List.prototype.assertNoDuplicateBindings=function(ruleName){this.expr.assertNoDuplicateBindings(ruleName)};pexprs.Obj.prototype.assertNoDuplicateBindings=function(ruleName){for(var idx=0;idx<this.properties.length;idx++){this.properties[idx].pattern.assertNoDuplicateBindings(ruleName)}var duplicates=common.getDuplicates(this.getBindingNames());if(duplicates.length>0){throw new errors.DuplicateBindingsError(ruleName,duplicates)}};pexprs.Apply.prototype.assertNoDuplicateBindings=function(ruleName){}},{"./common.js":14,"./errors.js":16,"./pexprs.js":27}],21:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var pexprs=_dereq_("./pexprs.js");var errors=_dereq_("./errors.js");function assertNoBindings(ruleName,expr){var bindings=expr.getBindingNames();if(bindings.length>0){throw new errors.UselessBindingsError(ruleName,bindings)}}pexprs.PExpr.prototype.assertNoUselessBindings=common.abstract;pexprs.anything.assertNoUselessBindings=function(ruleName){};pexprs.end.assertNoUselessBindings=function(ruleName){};pexprs.Prim.prototype.assertNoUselessBindings=function(ruleName){};pexprs.Alt.prototype.assertNoUselessBindings=function(ruleName){for(var idx=0;idx<this.terms.length;idx++){this.terms[idx].assertNoUselessBindings(ruleName)}};pexprs.Seq.prototype.assertNoUselessBindings=function(ruleName){for(var idx=0;idx<this.factors.length;idx++){this.factors[idx].assertNoUselessBindings(ruleName)}};pexprs.Bind.prototype.assertNoUselessBindings=function(ruleName){this.expr.assertNoUselessBindings(ruleName)};pexprs.Many.prototype.assertNoUselessBindings=function(ruleName){this.expr.assertNoUselessBindings(ruleName);assertNoBindings(ruleName,this.expr)};pexprs.Opt.prototype.assertNoUselessBindings=function(ruleName){this.expr.assertNoUselessBindings(ruleName);assertNoBindings(ruleName,this.expr)};pexprs.Not.prototype.assertNoUselessBindings=function(ruleName){this.expr.assertNoUselessBindings(ruleName);assertNoBindings(ruleName,this.expr)};pexprs.Lookahead.prototype.assertNoUselessBindings=function(ruleName){this.expr.assertNoUselessBindings(ruleName)};pexprs.Str.prototype.assertNoUselessBindings=function(ruleName){this.expr.assertNoUselessBindings(ruleName)};pexprs.List.prototype.assertNoUselessBindings=function(ruleName){this.expr.assertNoUselessBindings(ruleName)};pexprs.Obj.prototype.assertNoUselessBindings=function(ruleName){for(var idx=0;idx<this.properties.length;idx++){this.properties[idx].pattern.assertNoUselessBindings(ruleName)}};pexprs.Apply.prototype.assertNoUselessBindings=function(ruleName){}},{"./common.js":14,"./errors.js":16,"./pexprs.js":27}],22:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var errors=_dereq_("./errors.js");var thunks=_dereq_("./thunks.js");var pexprs=_dereq_("./pexprs.js");var skipSpaces=_dereq_("./skipSpaces.js");var InputStream=_dereq_("./InputStream.js");var awlib=_dereq_("awlib");var browser=awlib.browser;pexprs.PExpr.prototype.eval=common.abstract;pexprs.anything.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){if(syntactic){skipSpaces(ruleDict,inputStream)}var origPos=inputStream.pos;var value=inputStream.next();if(value===common.fail){if(recordFailures){inputStream.recordFailure(origPos,this)}return common.fail}else{return new thunks.ValueThunk(value)}};pexprs.end.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){if(syntactic){skipSpaces(ruleDict,inputStream)}if(inputStream.atEnd()){return thunks.valuelessThunk}else{if(recordFailures){inputStream.recordFailure(inputStream.pos,this)}return common.fail}};pexprs.Prim.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){if(syntactic){skipSpaces(ruleDict,inputStream)}var origPos=inputStream.pos;if(this.match(inputStream)===common.fail){if(recordFailures){inputStream.recordFailure(origPos,this)}return common.fail}else{return new thunks.ValueThunk(this.obj)}};pexprs.Prim.prototype.match=function(inputStream){return inputStream.matchExactly(this.obj)};pexprs.StringPrim.prototype.match=function(inputStream){return inputStream.matchString(this.obj)};pexprs.RegExpPrim.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){if(syntactic){skipSpaces(ruleDict,inputStream)}var origPos=inputStream.pos;if(inputStream.matchRegExp(this.obj)===common.fail){if(recordFailures){inputStream.recordFailure(origPos,this)}return common.fail}else{return new thunks.ValueThunk(inputStream.source[origPos])}};pexprs.Alt.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){var origPos=inputStream.pos;var origNumBindings=bindings.length;for(var idx=0;idx<this.terms.length;idx++){if(syntactic){skipSpaces(ruleDict,inputStream)}var value=this.terms[idx].eval(recordFailures,syntactic,ruleDict,inputStream,bindings);if(value!==common.fail){return value}else{inputStream.pos=origPos;if(bindings.length>origNumBindings){bindings.length=origNumBindings}}}return common.fail};pexprs.Seq.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){for(var idx=0;idx<this.factors.length;idx++){if(syntactic){skipSpaces(ruleDict,inputStream)}var factor=this.factors[idx];var value=factor.eval(recordFailures,syntactic,ruleDict,inputStream,bindings);if(value===common.fail){return common.fail}}return thunks.valuelessThunk};pexprs.Bind.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){var value=this.expr.eval(recordFailures,syntactic,ruleDict,inputStream,bindings);if(value!==common.fail){bindings.push(this.name,value)}return value};pexprs.Many.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){var matches=[];while(true){var backtrackPos=inputStream.pos;var value=this.expr.eval(recordFailures,syntactic,ruleDict,inputStream,[]);if(value===common.fail){inputStream.pos=backtrackPos;break}else{matches.push(value)}}return matches.length<this.minNumMatches?common.fail:new thunks.ListThunk(matches)};pexprs.Opt.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){var origPos=inputStream.pos;var value=this.expr.eval(recordFailures,syntactic,ruleDict,inputStream,[]);if(value===common.fail){inputStream.pos=origPos;return new thunks.ListThunk([])}else{return new thunks.ListThunk([value])}};pexprs.Not.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){var origPos=inputStream.pos;var value=this.expr.eval(false,syntactic,ruleDict,inputStream,[]);if(value!==common.fail){if(recordFailures){inputStream.recordFailure(origPos,this)}return common.fail}else{inputStream.pos=origPos;return thunks.valuelessThunk}};pexprs.Lookahead.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){var origPos=inputStream.pos;var value=this.expr.eval(recordFailures,syntactic,ruleDict,inputStream,[]);if(value!==common.fail){inputStream.pos=origPos}return value};pexprs.Str.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){if(syntactic){skipSpaces(ruleDict,inputStream)}var string=inputStream.next();if(typeof string==="string"){var stringInputStream=InputStream.newFor(string);var value=this.expr.eval(recordFailures,syntactic,ruleDict,stringInputStream,bindings);return value!==common.fail&&stringInputStream.atEnd()?new thunks.ValueThunk(string):common.fail}else{return common.fail}};pexprs.List.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){if(syntactic){skipSpaces(ruleDict,inputStream)}var list=inputStream.next();if(list instanceof Array){var listInputStream=InputStream.newFor(list);var value=this.expr.eval(recordFailures,syntactic,ruleDict,listInputStream,bindings);return value!==common.fail&&listInputStream.atEnd()?new thunks.ValueThunk(list):common.fail}else{return common.fail}};pexprs.Obj.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){if(syntactic){skipSpaces(ruleDict,inputStream)}var obj=inputStream.next();if(obj!==common.fail&&obj&&(typeof obj==="object"||typeof obj==="function")){var numOwnPropertiesMatched=0;for(var idx=0;idx<this.properties.length;idx++){var property=this.properties[idx];var value=obj[property.name];var valueInputStream=InputStream.newFor([value]);var matched=property.pattern.eval(recordFailures,syntactic,ruleDict,valueInputStream,bindings)!==common.fail&&valueInputStream.atEnd();if(!matched){return common.fail}if(obj.hasOwnProperty(property.name)){numOwnPropertiesMatched++}}return this.isLenient||numOwnPropertiesMatched===Object.keys(obj).length?new thunks.ValueThunk(obj):common.fail}else{return common.fail}};pexprs.Apply.prototype.eval=function(recordFailures,syntactic,ruleDict,inputStream,bindings){var ruleName=this.ruleName;var origPosInfo=inputStream.getCurrentPosInfo();var memoRec=origPosInfo.memo[ruleName];if(memoRec&&origPosInfo.shouldUseMemoizedResult(memoRec)){inputStream.pos=memoRec.pos;return memoRec.value}else if(origPosInfo.isActive(ruleName)){var currentLR=origPosInfo.getCurrentLeftRecursion();if(currentLR&&currentLR.name===ruleName){origPosInfo.updateInvolvedRules();inputStream.pos=currentLR.pos;return currentLR.value}else{origPosInfo.startLeftRecursion(ruleName);return common.fail}}else{var body=ruleDict[ruleName];if(!body){throw new errors.UndeclaredRuleError(ruleName)}var ruleIsSyntactic=common.isSyntactic(ruleName);var origPos=inputStream.pos;origPosInfo.enter(ruleName);var rf=recordFailures&&!body.description;var value=this.evalOnce(body,rf,ruleIsSyntactic,ruleDict,inputStream);var currentLR=origPosInfo.getCurrentLeftRecursion();if(currentLR){if(currentLR.name===ruleName){value=this.handleLeftRecursion(body,rf,ruleIsSyntactic,ruleDict,inputStream,origPos,currentLR,value);origPosInfo.memo[ruleName]={pos:inputStream.pos,value:value,involvedRules:currentLR.involvedRules};origPosInfo.endLeftRecursion(ruleName)}else if(!currentLR.involvedRules[ruleName]){origPosInfo.memo[ruleName]={pos:inputStream.pos,value:value}}}else{origPosInfo.memo[ruleName]={pos:inputStream.pos,value:value}}origPosInfo.exit(ruleName);if(value===common.fail&&recordFailures&&body.description){inputStream.recordFailure(origPos,this)}return value}};pexprs.Apply.prototype.evalOnce=function(expr,recordFailures,syntactic,ruleDict,inputStream){var origPos=inputStream.pos;var bindings=[];var value=expr.eval(recordFailures,syntactic,ruleDict,inputStream,bindings);if(value===common.fail){return common.fail}else{return new thunks.RuleThunk(this.ruleName,inputStream.source,origPos,inputStream.pos,value,bindings)}};pexprs.Apply.prototype.handleLeftRecursion=function(body,recordFailures,syntactic,ruleDict,inputStream,origPos,currentLR,seedValue){var value=seedValue;if(seedValue!==common.fail){currentLR.value=seedValue;currentLR.pos=inputStream.pos;while(true){inputStream.pos=origPos;value=this.evalOnce(body,recordFailures,syntactic,ruleDict,inputStream);if(value!==common.fail&&inputStream.pos>currentLR.pos){currentLR.value=value;currentLR.pos=inputStream.pos}else{value=currentLR.value;inputStream.pos=currentLR.pos;break}}}return value}},{"./InputStream.js":9,"./common.js":14,"./errors.js":16,"./pexprs.js":27,"./skipSpaces.js":28,"./thunks.js":29,awlib:2}],23:[function(_dereq_,module,exports){var pexprs=_dereq_("./pexprs.js");pexprs.PExpr.prototype.getBindingNames=function(){return[]};pexprs.Alt.prototype.getBindingNames=function(){return this.terms.length===0?[]:this.terms[0].getBindingNames()};pexprs.Seq.prototype.getBindingNames=function(){var names=[];for(var idx=0;idx<this.factors.length;idx++){names=names.concat(this.factors[idx].getBindingNames())}return names.sort()};pexprs.Bind.prototype.getBindingNames=function(){return[this.name]};pexprs.Lookahead.prototype.getBindingNames=function(){return this.expr.getBindingNames()};pexprs.Str.prototype.getBindingNames=function(){return this.expr.getBindingNames()};pexprs.List.prototype.getBindingNames=function(){return this.expr.getBindingNames()};pexprs.Obj.prototype.getBindingNames=function(){var names=[];for(var idx=0;idx<this.properties.length;idx++){names=names.concat(this.properties[idx].pattern.getBindingNames())}return names.sort()}},{"./pexprs.js":27}],24:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var pexprs=_dereq_("./pexprs.js");var awlib=_dereq_("awlib");var printString=awlib.stringUtils.printString;pexprs.PExpr.prototype.outputRecipe=common.abstract;pexprs.anything.outputRecipe=function(ws){};pexprs.end.outputRecipe=function(ws){};pexprs.Prim.prototype.outputRecipe=function(ws){ws.nextPutAll("b.prim(");ws.nextPutAll(printString(this.obj));ws.nextPutAll(")")};pexprs.Alt.prototype.outputRecipe=function(ws){ws.nextPutAll("b.alt(");for(var idx=0;idx<this.terms.length;idx++){if(idx>0){ws.nextPutAll(", ")}this.terms[idx].outputRecipe(ws)}ws.nextPutAll(")")};pexprs.Seq.prototype.outputRecipe=function(ws){ws.nextPutAll("b.seq(");for(var idx=0;idx<this.factors.length;idx++){if(idx>0){ws.nextPutAll(", ")}this.factors[idx].outputRecipe(ws)}ws.nextPutAll(")")};pexprs.Bind.prototype.outputRecipe=function(ws){ws.nextPutAll("b.bind(");this.expr.outputRecipe(ws);ws.nextPutAll(", ");ws.nextPutAll(printString(this.name));ws.nextPutAll(")")};pexprs.Many.prototype.outputRecipe=function(ws){ws.nextPutAll("b.many(");this.expr.outputRecipe(ws);ws.nextPutAll(", ");ws.nextPutAll(this.minNumMatches);ws.nextPutAll(")")};pexprs.Opt.prototype.outputRecipe=function(ws){ws.nextPutAll("b.opt(");this.expr.outputRecipe(ws);ws.nextPutAll(")")};pexprs.Not.prototype.outputRecipe=function(ws){ws.nextPutAll("b.not(");this.expr.outputRecipe(ws);ws.nextPutAll(")")};pexprs.Lookahead.prototype.outputRecipe=function(ws){ws.nextPutAll("b.la(");this.expr.outputRecipe(ws);ws.nextPutAll(")")};pexprs.Str.prototype.outputRecipe=function(ws){ws.nextPutAll("b.str(");this.expr.outputRecipe(ws);ws.nextPutAll(")")};pexprs.List.prototype.outputRecipe=function(ws){ws.nextPutAll("b.lst(");this.expr.outputRecipe(ws);ws.nextPutAll(")")};pexprs.Obj.prototype.outputRecipe=function(ws){function outputPropertyRecipe(prop){ws.nextPutAll("{name: ");ws.nextPutAll(printString(prop.name));ws.nextPutAll(", pattern: ");prop.pattern.outputRecipe(ws);ws.nextPutAll("}")}ws.nextPutAll("b.obj([");for(var idx=0;idx<this.properties.length;idx++){if(idx>0){ws.nextPutAll(", ")}outputPropertyRecipe(this.properties[idx])}ws.nextPutAll("], ");ws.nextPutAll(printString(!!this.isLenient));ws.nextPutAll(")")};pexprs.Apply.prototype.outputRecipe=function(ws){ws.nextPutAll("b.app(");ws.nextPutAll(printString(this.ruleName));ws.nextPutAll(")")}},{"./common.js":14,"./pexprs.js":27,awlib:2}],25:[function(_dereq_,module,exports){var pexprs=_dereq_("./pexprs.js");pexprs.PExpr.prototype.producesValue=function(){return true};pexprs.Alt.prototype.producesValue=function(){for(var idx=0;idx<this.terms.length;idx++){if(!this.terms[idx].producesValue()){return false}}return true};pexprs.Seq.prototype.producesValue=function(){return false};pexprs.Not.prototype.producesValue=function(){return false}},{"./pexprs.js":27}],26:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var pexprs=_dereq_("./pexprs.js");var awlib=_dereq_("awlib");var printString=awlib.stringUtils.printString;var makeStringBuffer=awlib.objectUtils.stringBuffer;pexprs.PExpr.prototype.toExpected=function(ruleDict){return undefined};pexprs.anything.toExpected=function(ruleDict){return"any object"};pexprs.end.toExpected=function(ruleDict){return"end of input"};pexprs.Prim.prototype.toExpected=function(ruleDict){return printString(this.obj)};pexprs.Not.prototype.toExpected=function(ruleDict){return"no "+this.expr.toExpected()};pexprs.Apply.prototype.toExpected=function(ruleDict){var description=ruleDict[this.ruleName].description;if(description){return description}else{var article=/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a";return article+" "+this.ruleName}}},{"./common.js":14,"./pexprs.js":27,awlib:2}],27:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var errors=_dereq_("./errors.js");var awlib=_dereq_("awlib");var objectThatDelegatesTo=awlib.objectUtils.objectThatDelegatesTo;function PExpr(){throw"PExpr cannot be instantiated -- it's abstract"}var anything=objectThatDelegatesTo(PExpr.prototype);var end=objectThatDelegatesTo(PExpr.prototype);function Prim(obj){this.obj=obj}Prim.prototype=objectThatDelegatesTo(PExpr.prototype);function StringPrim(obj){this.obj=obj}StringPrim.prototype=objectThatDelegatesTo(Prim.prototype);function RegExpPrim(obj){this.obj=obj}RegExpPrim.prototype=objectThatDelegatesTo(Prim.prototype);function Alt(terms){this.terms=terms}Alt.prototype=objectThatDelegatesTo(PExpr.prototype);function ExtendAlt(extensions,base){this.terms=[extensions,base]}ExtendAlt.prototype=objectThatDelegatesTo(Alt.prototype);function Seq(factors){this.factors=factors}Seq.prototype=objectThatDelegatesTo(PExpr.prototype);function Bind(expr,name){this.expr=expr;
this.name=name}Bind.prototype=objectThatDelegatesTo(PExpr.prototype);function Many(expr,minNumMatches){this.expr=expr;this.minNumMatches=minNumMatches}Many.prototype=objectThatDelegatesTo(PExpr.prototype);function Opt(expr){this.expr=expr}Opt.prototype=objectThatDelegatesTo(PExpr.prototype);function Not(expr){this.expr=expr}Not.prototype=objectThatDelegatesTo(PExpr.prototype);function Lookahead(expr){this.expr=expr}Lookahead.prototype=objectThatDelegatesTo(PExpr.prototype);function Str(expr){this.expr=expr}Str.prototype=objectThatDelegatesTo(PExpr.prototype);function List(expr){this.expr=expr}List.prototype=objectThatDelegatesTo(PExpr.prototype);function Obj(properties,isLenient){var names=properties.map(function(property){return property.name});var duplicates=common.getDuplicates(names);if(duplicates.length>0){throw new errors.DuplicatePropertyNamesError(duplicates)}else{this.properties=properties;this.isLenient=isLenient}}Obj.prototype=objectThatDelegatesTo(PExpr.prototype);function Apply(ruleName){this.ruleName=ruleName}Apply.prototype=objectThatDelegatesTo(PExpr.prototype);exports.makePrim=function(obj){if(typeof obj==="string"&&obj.length!==1){return new StringPrim(obj)}else if(obj instanceof RegExp){return new RegExpPrim(obj)}else{return new Prim(obj)}};exports.PExpr=PExpr;exports.anything=anything;exports.end=end;exports.Prim=Prim;exports.StringPrim=StringPrim;exports.RegExpPrim=RegExpPrim;exports.Alt=Alt;exports.ExtendAlt=ExtendAlt;exports.Seq=Seq;exports.Bind=Bind;exports.Many=Many;exports.Opt=Opt;exports.Not=Not;exports.Lookahead=Lookahead;exports.Str=Str;exports.List=List;exports.Obj=Obj;exports.Apply=Apply;_dereq_("./pexprs-addRulesThatNeedSemanticAction.js");_dereq_("./pexprs-assertNoDuplicateBindings.js");_dereq_("./pexprs-assertNoUselessBindings.js");_dereq_("./pexprs-assertChoicesHaveUniformBindings.js");_dereq_("./pexprs-getBindingNames.js");_dereq_("./pexprs-eval.js");_dereq_("./pexprs-outputRecipe.js");_dereq_("./pexprs-producesValue.js");_dereq_("./pexprs-toExpected.js")},{"./common.js":14,"./errors.js":16,"./pexprs-addRulesThatNeedSemanticAction.js":18,"./pexprs-assertChoicesHaveUniformBindings.js":19,"./pexprs-assertNoDuplicateBindings.js":20,"./pexprs-assertNoUselessBindings.js":21,"./pexprs-eval.js":22,"./pexprs-getBindingNames.js":23,"./pexprs-outputRecipe.js":24,"./pexprs-producesValue.js":25,"./pexprs-toExpected.js":26,awlib:2}],28:[function(_dereq_,module,exports){var common=_dereq_("./common.js");var pexprs=_dereq_("./pexprs.js");function skipSpaces(ruleDict,inputStream){while(true){var origPos=inputStream.pos;if(ruleDict.space.eval(false,false,ruleDict,inputStream,[])===common.fail){inputStream.pos=origPos;break}}}module.exports=skipSpaces},{"./common.js":14,"./pexprs.js":27}],29:[function(_dereq_,module,exports){var Interval=_dereq_("./Interval.js");var awlib=_dereq_("awlib");var browser=awlib.browser;var objectThatDelegatesTo=awlib.objectUtils.objectThatDelegatesTo;function Thunk(){throw"Thunk cannot be instantiated -- it's abstract"}var nextThunkId=0;Thunk.prototype={init:function(){this.id=nextThunkId++}};function RuleThunk(ruleName,source,startIdx,endIdx,value,bindings){this.init();this.ruleName=ruleName;this.source=source;this.startIdx=startIdx;this.endIdx=endIdx;this.value=value;this.bindings=bindings}RuleThunk.prototype=objectThatDelegatesTo(Thunk.prototype,{force:function(actionDict,memo){if(!memo.hasOwnProperty(this.id)){var action=this.lookupAction(actionDict);var addlInfo=this.createAddlInfo();var env=this.makeEnv(actionDict,memo);memo[this.id]=action.call(addlInfo,env)}return memo[this.id]},lookupAction:function(actionDict){var ruleName=this.ruleName;var action=actionDict[ruleName];if(action===undefined&&actionDict._default!==undefined){action=function(env){return actionDict._default.call(this,ruleName,env)}}return action||browser.error("missing semantic action for",ruleName)},createAddlInfo:function(){return{interval:new Interval(this.source,this.startIdx,this.endIdx)}},makeEnv:function(actionDict,memo){var bindings=this.bindings.length===0?["value",this.value]:this.bindings;var env={};for(var idx=0;idx<bindings.length;idx+=2){var name=bindings[idx];var thunk=bindings[idx+1];this.addBinding(env,name,thunk,actionDict,memo)}return env},addBinding:function(env,name,value,actionDict,memo){Object.defineProperty(env,name,{get:function(){if(value instanceof Thunk){value=value.force(actionDict,memo)}return value},enumerable:true})}});function ListThunk(thunks){this.init();this.thunks=thunks}ListThunk.prototype=objectThatDelegatesTo(Thunk.prototype,{force:function(actionDict,memo){if(!memo.hasOwnProperty(this.id)){memo[this.id]=this.thunks.map(function(thunk){return thunk.force(actionDict,memo)})}return memo[this.id]}});function ValueThunk(value){this.value=value}ValueThunk.prototype=objectThatDelegatesTo(Thunk.prototype,{force:function(actionDict,memo){return this.value}});exports.RuleThunk=RuleThunk;exports.ListThunk=ListThunk;exports.ValueThunk=ValueThunk;exports.valuelessThunk=new ValueThunk(undefined)},{"./Interval.js":10,awlib:2}]},{},[17])(17)});