!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.ohm=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
var ohm=_dereq_("../src/ohm.js");ohm._ohmGrammarFactory=function(e,n){var p=e.builder();return p.setName("Ohm"),p.inline("space-singleLine",p.seq(p._("//"),p.many(p.seq(p.not(p._("\n")),p.app("_")),0),p._("\n"))),p.inline("space-multiLine",p.seq(p._("/*"),p.many(p.seq(p.not(p._("*/")),p.app("_")),0),p._("*/"))),p.extend("space",p.alt(p.app("space-singleLine"),p.app("space-multiLine"))),p.define("_name",p.seq(p.app("nameFirst"),p.many(p.app("nameRest"),0))),p.define("nameFirst",p.alt(p._("_"),p.app("letter"))),p.define("nameRest",p.alt(p._("_"),p.app("alnum"))),p.define("name",p.seq(p.not(p.app("namedConst")),p.bind(p.app("_name"),"n"))),p.inline("namedConst-undefined",p.seq(p._("undefined"),p.not(p.app("nameRest")))),p.inline("namedConst-null",p.seq(p._("null"),p.not(p.app("nameRest")))),p.inline("namedConst-true",p.seq(p._("true"),p.not(p.app("nameRest")))),p.inline("namedConst-false",p.seq(p._("false"),p.not(p.app("nameRest")))),p.define("namedConst",p.alt(p.app("namedConst-undefined"),p.app("namedConst-null"),p.app("namedConst-true"),p.app("namedConst-false"))),p.define("string",p.seq(p._("'"),p.bind(p.many(p.app("sChar"),0),"cs"),p._("'"))),p.define("sChar",p.alt(p.seq(p._("\\x"),p.app("hexDigit"),p.app("hexDigit")),p.seq(p._("\\u"),p.app("hexDigit"),p.app("hexDigit"),p.app("hexDigit"),p.app("hexDigit")),p.seq(p._("\\"),p.app("_")),p.seq(p.not(p._("'")),p.app("_")))),p.define("regexp",p.seq(p._("/"),p.bind(p.app("reCharClass"),"e"),p._("/"))),p.define("reCharClass",p.seq(p._("["),p.many(p.alt(p._("\\]"),p.seq(p.not(p._("]")),p.app("_"))),0),p._("]"))),p.define("number",p.seq(p.opt(p._("-")),p.many(p.app("digit"),1))),p.inline("Alt-rec",p.seq(p.bind(p.app("Term"),"x"),p._("|"),p.bind(p.app("Alt"),"y"))),p.define("Alt",p.alt(p.app("Alt-rec"),p.app("Term"))),p.inline("Term-inline",p.seq(p.bind(p.app("Seq"),"x"),p._("{"),p.bind(p.app("_name"),"n"),p._("}"))),p.define("Term",p.alt(p.app("Term-inline"),p.app("Seq"))),p.define("Seq",p.many(p.app("Factor"),0)),p.inline("Factor-bind",p.seq(p.bind(p.app("Iter"),"x"),p._("."),p.bind(p.app("name"),"n"))),p.define("Factor",p.alt(p.app("Factor-bind"),p.app("Iter"))),p.inline("Iter-star",p.seq(p.bind(p.app("Pred"),"x"),p._("*"))),p.inline("Iter-plus",p.seq(p.bind(p.app("Pred"),"x"),p._("+"))),p.inline("Iter-opt",p.seq(p.bind(p.app("Pred"),"x"),p._("?"))),p.define("Iter",p.alt(p.app("Iter-star"),p.app("Iter-plus"),p.app("Iter-opt"),p.app("Pred"))),p.inline("Pred-not",p.seq(p._("~"),p.bind(p.app("Base"),"x"))),p.inline("Pred-lookahead",p.seq(p._("&"),p.bind(p.app("Base"),"x"))),p.define("Pred",p.alt(p.app("Pred-not"),p.app("Pred-lookahead"),p.app("Base"))),p.inline("Base-application",p.seq(p.bind(p.app("name"),"ruleName"),p.not(p.alt(p._("=="),p._(":="),p._("+="))))),p.inline("Base-prim",p.alt(p.app("namedConst"),p.app("string"),p.app("regexp"),p.app("number"))),p.inline("Base-lst",p.seq(p._("["),p.bind(p.app("Alt"),"x"),p._("]"))),p.inline("Base-str",p.seq(p._('"'),p.bind(p.app("Alt"),"x"),p._('"'))),p.inline("Base-paren",p.seq(p._("("),p.bind(p.app("Alt"),"x"),p._(")"))),p.inline("Base-obj",p.seq(p._("{"),p.bind(p.opt(p._("...")),"lenient"),p._("}"))),p.inline("Base-objWithProps",p.seq(p._("{"),p.bind(p.app("Props"),"ps"),p.bind(p.opt(p.seq(p._(","),p._("..."))),"lenient"),p._("}"))),p.define("Base",p.alt(p.app("Base-application"),p.app("Base-prim"),p.app("Base-lst"),p.app("Base-str"),p.app("Base-paren"),p.app("Base-obj"),p.app("Base-objWithProps"))),p.inline("Props-rec",p.seq(p.bind(p.app("Prop"),"p"),p._(","),p.bind(p.app("Props"),"ps"))),p.inline("Props-base",p.bind(p.app("Prop"),"p")),p.define("Props",p.alt(p.app("Props-rec"),p.app("Props-base"))),p.define("Prop",p.seq(p.bind(p.alt(p.app("_name"),p.app("string")),"n"),p._(":"),p.bind(p.app("Factor"),"p"))),p.inline("Rule-define",p.seq(p.bind(p.app("name"),"n"),p._("=="),p.bind(p.app("Alt"),"b"))),p.inline("Rule-override",p.seq(p.bind(p.app("name"),"n"),p._(":="),p.bind(p.app("Alt"),"b"))),p.inline("Rule-extend",p.seq(p.bind(p.app("name"),"n"),p._("+="),p.bind(p.app("Alt"),"b"))),p.define("Rule",p.alt(p.app("Rule-define"),p.app("Rule-override"),p.app("Rule-extend"))),p.inline("SuperGrammar-qualified",p.seq(p._("<:"),p.bind(p.app("name"),"ns"),p._("."),p.bind(p.app("name"),"n"))),p.inline("SuperGrammar-unqualified",p.seq(p._("<:"),p.bind(p.app("name"),"n"))),p.define("SuperGrammar",p.alt(p.app("SuperGrammar-qualified"),p.app("SuperGrammar-unqualified"))),p.define("Grammar",p.seq(p.bind(p.app("name"),"n"),p.bind(p.opt(p.app("SuperGrammar")),"s"),p._("{"),p.bind(p.many(p.app("Rule"),0),"rs"),p._("}"))),p.define("Grammars",p.many(p.app("Grammar"),0)),p.build(n)};
},{"../src/ohm.js":7}],2:[function(_dereq_,module,exports){
exports.objectUtils = _dereq_('./objectUtils.js')
exports.stringUtils = _dereq_('./stringUtils.js')
exports.equals = _dereq_('./equals.js')
exports.browser = _dereq_('./browser.js')

},{"./browser.js":3,"./equals.js":4,"./objectUtils.js":5,"./stringUtils.js":6}],3:[function(_dereq_,module,exports){
var thisModule = exports

// --------------------------------------------------------------------
// Logging
// --------------------------------------------------------------------

var subscribed = {}

exports.log = function(subject /* , ... */) {
  if (!subscribed[subject])
    return
  arguments[0] = '[' + subject + ']'
  console.log.apply(console, arguments)
}

exports.subscribe = function(subject) {
  subscribed[subject] = true
}

exports.unsubscribe = function(subject) {
  delete showing[subject]
}

// --------------------------------------------------------------------
// Asserts, errors, etc.
// --------------------------------------------------------------------

exports.error = function(/* arg1, arg2, ... */) {
  var args = Array.prototype.slice.call(arguments)
  console.error.apply(console, args)
  throw 'error: ' + args.join(' ')
}

exports.sanityCheck = function(name, condition) {
  if (!condition)
    thisModule.error('failed sanity check:', name)
}

// --------------------------------------------------------------------
// DOM utils
// --------------------------------------------------------------------

exports.prettyPrintNode = function(node, endNode, endOffset) {
  if (node instanceof Text) {
    if (node === endNode)
      return 'text{' + node.data.substr(0, endOffset) + '|' + node.data.substr(endOffset) + '}'
    else
      return 'text{' + node.data + '}'
  }

  var parts = [node.tagName, '{']
  for (var idx = 0; idx < node.childNodes.length; idx++) {
    if (node === endNode && endOffset == idx)
      parts.push('|')
    parts.push(thisModule.prettyPrintNode(node.childNodes.item(idx), endNode, endOffset))
  }
  if (node === endNode && endOffset == node.childNodes.length)
    parts.push('|')
  parts.push('}')
  return parts.join('')
}


},{}],4:[function(_dereq_,module,exports){
// Helpers

function doubleEquals(x, y) {
  return x == y
}

function tripleEquals(x, y) {
  return x === y
}

function isPrimitive(x) {
  var type = typeof x
  return type !== 'object'
}

function equals(x, y, deep, eqFn) {
  if (isPrimitive(x))
    return eqFn(x, y)
  for (var p in x)
    if (deep && !equals(x[p], y[p], deep, eqFn) ||
        !deep && !eqFn(x[p], y[p]))
      return false
  for (var p in y)
    if (y[p] !== undefined &&
        x[p] === undefined)
      return false
  return true
}

function haveSameContentsInAnyOrder(arr1, arr2, deep, eqFn) {
  if (!arr1 instanceof Array || !arr2 instanceof Array ||
      arr1.length !== arr2.length)
    return false
  for (var idx = 0; idx < arr1.length; idx++) {
    var x = arr1[idx]
    var foundX = arr2.some(function(y) {
      return equals(x, y, deep, eqFn)
    })
    if (!foundX)
      return false
  }
  return true
}

// Public methods

exports.equals = function(x, y) {
  return equals(x, y, false, doubleEquals)
}

exports.deepEquals = function(x, y) {
  return equals(x, y, true, doubleEquals)
}

exports.strictEquals = function(x, y) {
  return equals(x, y, false, tripleEquals)
}

exports.strictDeepEquals = function(x, y) {
  return equals(x, y, true, tripleEquals)
}

exports.haveSameContentsInAnyOrder = function(arr1, arr2) {
  return haveSameContentsInAnyOrder(arr1, arr2, true, doubleEquals)
}


},{}],5:[function(_dereq_,module,exports){
var thisModule = exports

exports.objectThatDelegatesTo = function(obj, optProperties) {
  function cons() {}
  cons.prototype = obj
  var ans = new cons()
  if (optProperties)
    thisModule.keysAndValuesDo(optProperties, function(k, v) {
      ans[k] = v
    })
  return ans
}

exports.formals = function(func) {
  return func.
    toString().
    match(/\((.*?)\)/)[0].
    replace(/ /g, '').
    slice(1, -1).
    split(',').
    filter(function(moduleName) { return moduleName != '' })
}

exports.keysDo = function(object, fn) {
  for (var p in object)
    if (object.hasOwnProperty(p))
      fn(p)
}

exports.valuesDo = function(object, fn) {
  thisModule.keysDo(object, function(p) { fn(object[p]) })
}

exports.keysAndValuesDo = function(object, fn) {
  thisModule.keysDo(object, function(p) { fn(p, object[p]) })
}

exports.keysIterator = function(object) {
  return function(fn) { self.keysDo(object, fn) }
}

exports.valuesIterator = function(object) {
  return function(fn) { self.valuesDo(object, fn) }
}

exports.keysAndValuesIterator = function(object) {
  return function(fn) { self.keysAndValuesDo(object, fn) }
}

exports.values = function(object) {
  var ans = []
  thisModule.keysDo(object, function(p) { ans.push(object[p]) })
  return ans
}

function StringBuffer() {
  this.strings = []
  this.lengthSoFar = 0
}

StringBuffer.prototype = {
  nextPutAll: function(s) {
    this.strings.push(s)
    this.lengthSoFar += s.length
  },

  contents: function()  {
    return this.strings.join('')
  }
}

exports.stringBuffer = function() {
  return new StringBuffer()
}

function ColumnStringBuffer() {
  this.lines = []
  this.newLine()
}

ColumnStringBuffer.prototype = {
  nextPutAll: function(s) {
    this.currentColumn().push(s)
  },

  contents: function() {
    // Convert columns from lists of strings to strings, and record column lengths
    var columnLengths = []
    this.lines.forEach(function(line) {
      for (var colIdx = 0; colIdx < line.length; colIdx++) {
        var column = line[colIdx]
        line[colIdx] = column.join('')
        if (columnLengths[colIdx] === undefined || columnLengths[colIdx] < line[colIdx].length)
          columnLengths[colIdx] = line[colIdx].length
      }
    })

    var sb = thisModule.stringBuffer()
    this.lines.forEach(function(line) {
      for (var colIdx = 0; colIdx < line.length; colIdx++) {
        var column = line[colIdx]
        sb.nextPutAll(column)
        var numSpaces = columnLengths[colIdx] - column.length
        while (numSpaces-- > 0)
          sb.nextPutAll(' ')
      }
      sb.nextPutAll('\n')
    })
    return sb.contents()
  },

  newLine: function() {
    this.lines.push([])
    this.newColumn()
  },

  newColumn: function() {
    this.currentLine().push([])
  },

  currentColumn: function() {
    var line = this.currentLine()
    return line[line.length - 1]
  },

  currentLine: function() {
    return this.lines[this.lines.length - 1]
  }
}

exports.columnStringBuffer = function() {
  return new ColumnStringBuffer()
}


},{}],6:[function(_dereq_,module,exports){
var objectUtils = _dereq_('./objectUtils.js')
var thisModule = exports

// Helpers

function pad(numberAsString, len) {
  var zeros = []
  for (var idx = 0; idx < numberAsString.length - len; idx++)
    zeros.push('0')
  return zeros.join('') + numberAsString
}

var escapeStringFor = {}
for (var c = 0; c < 128; c++)
  escapeStringFor[c] = String.fromCharCode(c)
escapeStringFor["'".charCodeAt(0)]  = "\\'"
escapeStringFor['"'.charCodeAt(0)]  = '\\"'
escapeStringFor['\\'.charCodeAt(0)] = '\\\\'
escapeStringFor['\b'.charCodeAt(0)] = '\\b'
escapeStringFor['\f'.charCodeAt(0)] = '\\f'
escapeStringFor['\n'.charCodeAt(0)] = '\\n'
escapeStringFor['\r'.charCodeAt(0)] = '\\r'
escapeStringFor['\t'.charCodeAt(0)] = '\\t'
escapeStringFor['\v'.charCodeAt(0)] = '\\v'

// Public methods

exports.escapeChar = function(c, optDelim) {
  var charCode = c.charCodeAt(0)
  if ((c == '"' || c == "'") && optDelim && c !== optDelim)
    return c
  else if (charCode < 128)
    return escapeStringFor[charCode]
  else if (128 <= charCode && charCode < 256)
    return '\\x' + pad(charCode.toString(16), 2)
  else
    return '\\u' + pad(charCode.toString(16), 4)
}

exports.unescapeChar = function(s) {
  if (s.charAt(0) == '\\')
    switch (s.charAt(1)) {
      case 'b':  return '\b'
      case 'f':  return '\f'
      case 'n':  return '\n'
      case 'r':  return '\r'
      case 't':  return '\t'
      case 'v':  return '\v'
      case 'x':  return String.fromCharCode(parseInt(s.substring(2, 4), 16))
      case 'u':  return String.fromCharCode(parseInt(s.substring(2, 6), 16))
      default:   return s.charAt(1)
    }
  else
    return s
}

function printOn(x, ws) {
  if (x instanceof Array) {
    ws.nextPutAll('[')
    for (var idx = 0; idx < x.length; idx++) {
      if (idx > 0)
        ws.nextPutAll(', ')
      printOn(x[idx], ws)
    }
    ws.nextPutAll(']')
  } else if (typeof x === 'string') {
    var hasSingleQuotes = x.indexOf("'") >= 0
    var hasDoubleQuotes = x.indexOf('"') >= 0
    var delim = hasSingleQuotes && !hasDoubleQuotes ? '"' : "'"
    ws.nextPutAll(delim)
    for (var idx = 0; idx < x.length; idx++)
      ws.nextPutAll(thisModule.escapeChar(x[idx], delim))
    ws.nextPutAll(delim)
  } else if (x === null) {
    ws.nextPutAll('null')
  } else if (typeof x === 'object' && !(x instanceof RegExp)) {
    ws.nextPutAll('{')
    var first = true
    objectUtils.keysAndValuesDo(x, function(k, v) {
      if (first)
        first = false
      else
        ws.nextPutAll(', ')
      printOn(k, ws)
      ws.nextPutAll(': ')
      printOn(v, ws)
    })
    ws.nextPutAll('}')
  } else
    ws.nextPutAll('' + x)
}

exports.printString = function(obj) {
  var ws = objectUtils.stringBuffer()
  printOn(obj, ws)
  return ws.contents()
}


},{"./objectUtils.js":5}],7:[function(_dereq_,module,exports){
function getDuplicates(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];t.lastIndexOf(i)!==n&&e.indexOf(i)<0&&e.push(i)}return e}function abstract(){throw"this method is abstract!"}function isSyntactic(t){var e=t[0];return e>="A"&&"Z">=e}function skipSpaces(t,e){(_applySpaces||(_applySpaces=new Apply("spaces"))).eval(!1,t,e,void 0)}function InputStream(){throw"InputStream cannot be instantiated -- it's abstract"}function StringInputStream(t){this.init(t)}function ListInputStream(t){this.init(t)}function PosInfo(t){this.pos=t,this.ruleStack=[],this.activeRules={},this.memo={}}function Interval(t,e,n){this.source=t,this.startIdx=e,this.endIdx=n}function Thunk(){}function RuleThunk(t,e,n,i,r,s){this.init(),this.ruleName=t,this.source=e,this.startIdx=n,this.endIdx=i,this.value=r,this.bindings=s}function ListThunk(t){this.init(),this.thunks=t}function ValueThunk(t){this.value=t}function Pattern(){throw"Pattern cannot be instantiated -- it's abstract"}function Prim(t){this.obj=t}function StringPrim(t){this.obj=t}function RegExpPrim(t){this.obj=t}function Alt(t){this.terms=t}function Seq(t){this.factors=t}function Bind(t,e){this.expr=t,this.name=e}function Many(t,e){this.expr=t,this.minNumMatches=e}function Opt(t){this.expr=t}function Not(t){this.expr=t}function Lookahead(t){this.expr=t}function Str(t){this.expr=t}function List(t){this.expr=t}function Obj(t,e){var n=t.map(function(t){return t.name}),i=getDuplicates(n);i.length>0?browser.error("object pattern has duplicate property names:",i):(this.properties=t,this.isLenient=e)}function Apply(t){this.ruleName=t}function _Expand(t,e){void 0===e.ruleDict[t]?browser.error("grammar",e.name,"does not have a rule called",t):(this.ruleName=t,this.grammar=e)}function Grammar(t){this.ruleDict=t}function RuleDecl(){throw"RuleDecl cannot be instantiated -- it's abstract"}function Define(t,e,n){this.name=t,this.body=e,this.superGrammar=n}function Override(t,e,n){this.name=t,this.body=e,this.superGrammar=n}function Inline(t,e,n){this.name=t,this.body=e,this.superGrammar=n}function Extend(t,e,n){this.name=t,this.body=e,this.expandedBody=new Alt([e,new _Expand(t,n)]),this.superGrammar=n}function Builder(){this.init()}function Namespace(t){this.name=t,this.grammars={}}function makeGrammarActionDict(t){var e;return{space:function(){},"space-multiLine":function(){},"space-singleLine":function(){},_name:function(){return this.interval.contents()},nameFirst:function(){},nameRest:function(){},name:function(t){return t.n},namedConst:function(t){return t.value},"namedConst-undefined":function(){return void 0},"namedConst-null":function(){return null},"namedConst-true":function(){return!0},"namedConst-false":function(){return!1},string:function(t){return t.cs.map(function(t){return stringUtils.unescapeChar(t)}).join("")},sChar:function(){return this.interval.contents()},regexp:function(t){return new RegExp(t.e)},reCharClass:function(){return this.interval.contents()},number:function(){return parseInt(this.interval.contents())},Alt:function(t){return t.value},"Alt-rec":function(t){return e.alt(t.x,t.y)},Term:function(t){return t.value},"Term-inline":function(t){return e.inline(e.currentRuleName+"-"+t.n,t.x)},Seq:function(t){return e.seq.apply(e,t.value)},Factor:function(t){return t.value},"Factor-bind":function(t){return e.bind(t.x,t.n)},Iter:function(t){return t.value},"Iter-star":function(t){return e.many(t.x,0)},"Iter-plus":function(t){return e.many(t.x,1)},"Iter-opt":function(t){return e.opt(t.x)},Pred:function(t){return t.value},"Pred-not":function(t){return e.not(t.x)},"Pred-lookahead":function(t){return e.la(t.x)},Base:function(t){return t.value},"Base-undefined":function(){return e._(void 0)},"Base-null":function(){return e._(null)},"Base-true":function(){return e._(!0)},"Base-false":function(){return e._(!1)},"Base-application":function(t){return e.app(t.ruleName)},"Base-prim":function(t){return e._(t.value)},"Base-lst":function(t){return e.lst(t.x)},"Base-str":function(t){return e.str(t.x)},"Base-paren":function(t){return t.x},"Base-obj":function(t){return e.obj([],t.lenient)},"Base-objWithProps":function(t){return e.obj(t.ps,t.lenient)},Props:function(t){return t.value},"Props-base":function(t){return[t.p]},"Props-rec":function(t){return[t.p].concat(t.ps)},Prop:function(t){return{name:t.n,pattern:t.p}},Rule:function(t){return t.value},"Rule-define":function(t){return e.currentRuleName=t.n,e.define(t.n,t.b)},"Rule-override":function(t){return e.currentRuleName=t.n,e.override(t.n,t.b)},"Rule-extend":function(t){return e.currentRuleName=t.n,e.extend(t.n,t.b)},SuperGrammar:function(t){e.setSuperGrammar(t.value)},"SuperGrammar-qualified":function(t){return thisModule.namespace(t.ns).getGrammar(t.n)},"SuperGrammar-unqualified":function(e){return t.getGrammar(e.n)},Grammar:function(n){return e=new Builder,e.setName(n.n),n.s,n.rs,e.build(t)},Grammars:function(t){return t.value}}}function compileAndLoad(t,e,n){var i=thisModule._ohmGrammar.matchContents(t,e);return i?i(makeGrammarActionDict(n)):void browser.error("invalid input in:",t)}function makeGrammar(t,e){return compileAndLoad(t,"Grammar",e)}function makeGrammars(t,e){return compileAndLoad(t,"Grammars",e)}_dereq_("../dist/ohm-grammar.js");var awlib=_dereq_("awlib"),objectUtils=awlib.objectUtils,stringUtils=awlib.stringUtils,browser=awlib.browser,equals=awlib.equals,thisModule=exports,fail={},_applySpaces;InputStream.newFor=function(t){if("string"==typeof t)return new StringInputStream(t);if(t instanceof Array)return new ListInputStream(t);throw"cannot make input stream for "+t},InputStream.prototype={init:function(t){this.source=t,this.pos=0,this.posInfos=[]},getCurrentPosInfo:function(){var t=this.pos,e=this.posInfos[t];return e||(this.posInfos[t]=new PosInfo(t))},atEnd:function(){return this.pos===this.source.length},next:function(){return this.atEnd()?fail:this.source[this.pos++]},matchExactly:function(t){return this.next()===t?!0:fail},interval:function(t,e){return this.source.slice(t,e)}},StringInputStream.prototype=objectUtils.objectThatDelegatesTo(InputStream.prototype,{matchString:function(t){for(var e=0;e<t.length;e++)if(this.matchExactly(t[e])===fail)return fail;return!0},matchRegExp:function(t){var e=this.next();return e!==fail&&t.test(e)?!0:fail}}),ListInputStream.prototype=objectUtils.objectThatDelegatesTo(InputStream.prototype,{matchString:function(t){return this.matchExactly(t)},matchRegExp:function(t){return this.matchExactly(t)}}),PosInfo.prototype={isActive:function(t){return this.activeRules[t]},enter:function(t){this.ruleStack.push(t),this.activeRules[t]=!0},exit:function(t){this.ruleStack.pop(),this.activeRules[t]=!1},shouldUseMemoizedResult:function(t){var e=t.involvedRules;for(var n in e)if(e[n]&&this.activeRules[n])return!1;return!0},getCurrentLeftRecursion:function(){return this.leftRecursionStack?this.leftRecursionStack[this.leftRecursionStack.length-1]:void 0},startLeftRecursion:function(t){this.leftRecursionStack||(this.leftRecursionStack=[]),this.leftRecursionStack.push({name:t,value:fail,pos:-1,involvedRules:{}}),this.updateInvolvedRules()},endLeftRecursion:function(){this.leftRecursionStack.pop()},updateInvolvedRules:function(){for(var t=this.getCurrentLeftRecursion(),e=t.involvedRules,n=t.name,i=this.ruleStack.length-1;;){var r=this.ruleStack[i--];if(r===n)break;e[r]=!0}}},Interval.prototype={contents:function(){return InputStream.newFor(this.source).interval(this.startIdx,this.endIdx)},onlyElement:function(){return this.startIdx+1===this.endIdx?this.source[this.startIdx]:void browser.error("interval",this,"was expected to contain only one element")}};var nextThunkId=0;Thunk.prototype={init:function(){this.id=nextThunkId++}},RuleThunk.prototype=objectUtils.objectThatDelegatesTo(Thunk.prototype,{force:function(t,e){if(!e.hasOwnProperty(this.id)){var n=this.lookupAction(t),i=this.createAddlInfo(),r=this.makeEnv(t,e);e[this.id]=n.call(i,r)}return e[this.id]},lookupAction:function(t){var e=this.ruleName,n=t[e];return void 0===n&&void 0!==t._default&&(n=function(n){return t._default.call(this,e,n)}),n||browser.error("missing semantic action for",e)},createAddlInfo:function(){return{interval:new Interval(this.source,this.startIdx,this.endIdx)}},makeEnv:function(t,e){for(var n=0===this.bindings.length?["value",this.value]:this.bindings,i={},r=0;r<n.length;r+=2){var s=n[r],a=n[r+1];this.addBinding(i,s,a,t,e)}return i},addBinding:function(t,e,n,i,r){Object.defineProperty(t,e,{get:function(){return n instanceof Thunk&&(n=n.force(i,r)),n},enumerable:!0})}}),ListThunk.prototype=objectUtils.objectThatDelegatesTo(Thunk.prototype,{force:function(t,e){return e.hasOwnProperty(this.id)||(e[this.id]=this.thunks.map(function(n){return n.force(t,e)})),e[this.id]}}),ValueThunk.prototype=objectUtils.objectThatDelegatesTo(Thunk.prototype,{force:function(){return this.value}});var valuelessThunk=new ValueThunk(void 0);Pattern.prototype={getBindingNames:function(){return[]},producesValue:function(){return!0},assertNoDuplicateBindings:abstract,assertChoicesHaveUniformBindings:abstract,outputRecipe:abstract};var anything=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n){t&&skipSpaces(e,n);var i=n.next();return i===fail?fail:new ValueThunk(i)},assertNoDuplicateBindings:function(){},assertChoicesHaveUniformBindings:function(){},outputRecipe:function(){}});Prim.newFor=function(t){return"string"==typeof t&&1!==t.length?new StringPrim(t):t instanceof RegExp?new RegExpPrim(t):new Prim(t)},Prim.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n){return t&&skipSpaces(e,n),this.match(n)===fail?fail:new ValueThunk(this.obj)},match:function(t){return t.matchExactly(this.obj)},assertNoDuplicateBindings:function(){},assertChoicesHaveUniformBindings:function(){},outputRecipe:function(t){t.nextPutAll("b._("),t.nextPutAll(stringUtils.printString(this.obj)),t.nextPutAll(")")}}),StringPrim.prototype=objectUtils.objectThatDelegatesTo(Prim.prototype,{match:function(t){return t.matchString(this.obj)}}),RegExpPrim.prototype=objectUtils.objectThatDelegatesTo(Prim.prototype,{eval:function(t,e,n){t&&skipSpaces(e,n);var i=n.pos;return n.matchRegExp(this.obj)===fail?fail:new ValueThunk(n.source[i])}}),Alt.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n,i){for(var r=n.pos,s=i.length,a=0;a<this.terms.length;a++){t&&skipSpaces(e,n);var o=this.terms[a].eval(t,e,n,i);if(o!==fail)return o;n.pos=r,i.length>s&&(i.length=s)}return fail},getBindingNames:function(){return 0===this.terms.length?[]:this.terms[0].getBindingNames()},producesValue:function(){for(var t=0;t<this.terms.length;t++)if(!this.terms[t].producesValue())return!1;return!0},assertNoDuplicateBindings:function(t){for(var e=0;e<this.terms.length;e++)this.terms[e].assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){if(0!==this.terms.length)for(var e=this.terms[0].getBindingNames(),n=0;n<this.terms.length;n++){var i=this.terms[n];i.assertChoicesHaveUniformBindings();var r=i.getBindingNames();equals.equals(e,r)||browser.error("rule",t,"has an alt with inconsistent bindings:",e,"vs",r)}},outputRecipe:function(t){t.nextPutAll("b.alt(");for(var e=0;e<this.terms.length;e++)e>0&&t.nextPutAll(", "),this.terms[e].outputRecipe(t);t.nextPutAll(")")}}),Seq.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n,i){for(var r=0;r<this.factors.length;r++){t&&skipSpaces(e,n);var s=this.factors[r],a=s.eval(t,e,n,i);if(a===fail)return fail}return valuelessThunk},getBindingNames:function(){for(var t=[],e=0;e<this.factors.length;e++)t=t.concat(this.factors[e].getBindingNames());return t.sort()},producesValue:function(){return!1},assertNoDuplicateBindings:function(t){for(var e=0;e<this.factors.length;e++)this.factors[e].assertNoDuplicateBindings(t);var n=getDuplicates(this.getBindingNames());n.length>0&&browser.error("rule",t,"has duplicate bindings:",n)},assertChoicesHaveUniformBindings:function(t){for(var e=0;e<this.factors.length;e++)this.factors[e].assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){t.nextPutAll("b.seq(");for(var e=0;e<this.factors.length;e++)e>0&&t.nextPutAll(", "),this.factors[e].outputRecipe(t);t.nextPutAll(")")}}),Bind.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n,i){var r=this.expr.eval(t,e,n,i);return r!==fail&&i.push(this.name,r),r},getBindingNames:function(){return[this.name]},assertNoDuplicateBindings:function(t){this.expr.assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){return this.expr.assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){t.nextPutAll("b.bind("),this.expr.outputRecipe(t),t.nextPutAll(", "),t.nextPutAll(stringUtils.printString(this.name)),t.nextPutAll(")")}}),Many.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n){for(var i=[];;){var r=n.pos,s=this.expr.eval(t,e,n,[]);if(s===fail){n.pos=r;break}i.push(s)}return i.length<this.minNumMatches?fail:new ListThunk(i)},assertNoDuplicateBindings:function(t){this.expr.assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){return this.expr.assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){t.nextPutAll("b.many("),this.expr.outputRecipe(t),t.nextPutAll(", "),t.nextPutAll(this.minNumMatches),t.nextPutAll(")")}}),Opt.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n){var i=n.pos,r=this.expr.eval(t,e,n,[]);return r===fail?(n.pos=i,valuelessThunk):new ListThunk([r])},assertNoDuplicateBindings:function(t){this.expr.assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){return this.expr.assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){t.nextPutAll("b.opt("),this.expr.outputRecipe(t),t.nextPutAll(")")}}),Not.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n){var i=n.pos,r=this.expr.eval(t,e,n,[]);return r!==fail?fail:(n.pos=i,valuelessThunk)},producesValue:function(){return!1},assertNoDuplicateBindings:function(t){this.expr.assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){return this.expr.assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){t.nextPutAll("b.not("),this.expr.outputRecipe(t),t.nextPutAll(")")}}),Lookahead.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n){var i=n.pos,r=this.expr.eval(t,e,n,[]);return r!==fail?(n.pos=i,r):fail},getBindingNames:function(){return this.expr.getBindingNames()},assertNoDuplicateBindings:function(t){this.expr.assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){return this.expr.assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){t.nextPutAll("b.la("),this.expr.outputRecipe(t),t.nextPutAll(")")}}),Str.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n,i){t&&skipSpaces(e,n);var r=n.next();if("string"==typeof r){var s=new StringInputStream(r),a=this.expr.eval(t,e,s,i);return a!==fail&&s.atEnd()?new ValueThunk(r):fail}return fail},getBindingNames:function(){return this.expr.getBindingNames()},assertNoDuplicateBindings:function(t){this.expr.assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){return this.expr.assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){t.nextPutAll("b.str("),this.expr.outputRecipe(t),t.nextPutAll(")")}}),List.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n,i){t&&skipSpaces(e,n);var r=n.next();if(r instanceof Array){var s=new ListInputStream(r),a=this.expr.eval(t,e,s,i);return a!==fail&&s.atEnd()?new ValueThunk(r):fail}return fail},getBindingNames:function(){return this.expr.getBindingNames()},assertNoDuplicateBindings:function(t){this.expr.assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){return this.expr.assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){t.nextPutAll("b.lst("),this.expr.outputRecipe(t),t.nextPutAll(")")}}),Obj.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n,i){t&&skipSpaces(e,n);var r=n.next();if(r===fail||!r||"object"!=typeof r&&"function"!=typeof r)return fail;for(var s=0,a=0;a<this.properties.length;a++){var o=this.properties[a],u=r[o.name],c=new ListInputStream([u]),l=o.pattern.eval(t,e,c,i)!==fail&&c.atEnd();if(!l)return fail;r.hasOwnProperty(o.name)&&s++}return this.isLenient||s===Object.keys(r).length?new ValueThunk(r):fail},getBindingNames:function(){for(var t=[],e=0;e<this.properties.length;e++)t=t.concat(this.properties[e].pattern.getBindingNames());return t.sort()},assertNoDuplicateBindings:function(t){for(var e=0;e<this.properties.length;e++)this.properties[e].pattern.assertNoDuplicateBindings(t);var n=getDuplicates(this.getBindingNames());n.length>0&&browser.error("rule",t,"has an object pattern with duplicate bindings:",n)},assertChoicesHaveUniformBindings:function(t){for(var e=0;e<this.properties.length;e++)this.properties[e].pattern.assertChoicesHaveUniformBindings(t)},outputRecipe:function(t){function e(e){t.nextPutAll("{name: "),t.nextPutAll(stringUtils.printString(e.name)),t.nextPutAll(", pattern: "),e.pattern.outputRecipe(t),t.nextPutAll("}")}t.nextPutAll("b.obj([");for(var n=0;n<this.properties.length;n++)n>0&&t.nextPutAll(", "),e(this.properties[n]);t.nextPutAll("], "),t.nextPutAll(stringUtils.printString(!!this.isLenient)),t.nextPutAll(")")}}),Apply.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n){var i=this.ruleName,r=n.getCurrentPosInfo(),s=r.memo[i];if(s&&r.shouldUseMemoizedResult(s))return n.pos=s.pos,s.value;if(r.isActive(i)){var a=r.getCurrentLeftRecursion();return a&&a.name===i?(r.updateInvolvedRules(),n.pos=a.pos,a.value):(r.startLeftRecursion(i),fail)}var o=e[i]||browser.error("undefined rule",i);r.enter(i);var u=this.evalOnce(o,e,n),a=r.getCurrentLeftRecursion();return a?a.name===i?(u=this.handleLeftRecursion(o,e,n,r.pos,a,u),r.memo[i]={pos:n.pos,value:u,involvedRules:a.involvedRules},r.endLeftRecursion(i)):a.involvedRules[i]||(r.memo[i]={pos:n.pos,value:u}):r.memo[i]={pos:n.pos,value:u},r.exit(i),u},evalOnce:function(t,e,n){var i=n.pos,r=[],s=t.eval(isSyntactic(this.ruleName),e,n,r);return s===fail?fail:new RuleThunk(this.ruleName,n.source,i,n.pos,s,r)},handleLeftRecursion:function(t,e,n,i,r,s){var a=s;if(s!==fail)for(r.value=s,r.pos=n.pos;;){if(n.pos=i,a=this.evalOnce(t,e,n),!(a!==fail&&n.pos>r.pos)){a=r.value,n.pos=r.pos;break}r.value=a,r.pos=n.pos}return a},assertNoDuplicateBindings:function(){},assertChoicesHaveUniformBindings:function(){},outputRecipe:function(t){t.nextPutAll("b.app("),t.nextPutAll(stringUtils.printString(this.ruleName)),t.nextPutAll(")")}}),_Expand.prototype=objectUtils.objectThatDelegatesTo(Pattern.prototype,{eval:function(t,e,n,i){return this.expansion().eval(t,e,n,i)},expansion:function(){return this.grammar.ruleDict[this.ruleName]},getBindingNames:function(){return this.expansion().getBindingNames()},producesValue:function(){return this.expansion().producesValue()},assertNoDuplicateBindings:function(t){this.expansion().assertNoDuplicateBindings(t)},assertChoicesHaveUniformBindings:function(t){this.expansion().assertChoicesHaveUniformBindings(t)},outputRecipe:function(){}}),Grammar.prototype={ruleDict:new function(){this._=anything,this.end=new Not(this._),this.space=Prim.newFor(/[\s]/),this.spaces=new Many(new Apply("space"),0),this.alnum=Prim.newFor(/[0-9a-zA-Z]/),this.letter=Prim.newFor(/[a-zA-Z]/),this.lower=Prim.newFor(/[a-z]/),this.upper=Prim.newFor(/[A-Z]/),this.digit=Prim.newFor(/[0-9]/),this.hexDigit=Prim.newFor(/[0-9a-fA-F]/)},match:function(t,e){return this.matchContents([t],e)},matchContents:function(t,e){var n=InputStream.newFor(t),i=new Apply(e).eval(void 0,this.ruleDict,n,void 0);isSyntactic(e)&&skipSpaces(this.ruleDict,n);var r=this.assertSemanticActionNamesMatch.bind(this);return i!==fail&&n.atEnd()?function(t){return r(t),i.force(t,{})}:!1},assertSemanticActionNamesMatch:function(t){var e=this,n=this.ruleDict,i=!0;objectUtils.keysDo(n,function(n){if(void 0!==t[n]){var r=objectUtils.formals(t[n]).sort(),s=e.semanticActionArgNames(n);equals.equals(r,s)||(i=!1,console.log("semantic action for rule",n,"has the wrong argument names"),console.log("  expected",s),console.log("    actual",r))}}),i||browser.error("one or more semantic actions have the wrong argument names -- see console for details")},semanticActionArgNames:function(t){if(this.superGrammar&&this.superGrammar.ruleDict[t])return this.superGrammar.semanticActionArgNames(t);var e=this.ruleDict[t],n=e.getBindingNames();return n.length>0||e.producesValue()?["env"]:[]},toRecipe:function(){var t=objectUtils.stringBuffer();t.nextPutAll("(function(ohm, optNamespace) {\n"),t.nextPutAll("  var b = ohm.builder()\n"),t.nextPutAll("  b.setName("),t.nextPutAll(stringUtils.printString(this.name)),t.nextPutAll(")\n"),this.superGrammar.name&&this.superGrammar.namespaceName&&(t.nextPutAll("  b.setSuperGrammar(ohm.namespace("),t.nextPutAll(stringUtils.printString(this.superGrammar.namespaceName)),t.nextPutAll(").getGrammar("),t.nextPutAll(stringUtils.printString(this.superGrammar.name)),t.nextPutAll("))\n"));for(var e=0;e<this.ruleDecls.length;e++)t.nextPutAll("  "),this.ruleDecls[e].outputRecipe(t),t.nextPutAll("\n");return t.nextPutAll("  return b.build(optNamespace)\n"),t.nextPutAll("})"),t.contents()},toSemanticActionTemplate:function(){var t=this,e=objectUtils.columnStringBuffer();e.nextPutAll("{");var n=!0;return objectUtils.keysAndValuesDo(this.ruleDict,function(i,r){n?n=!1:e.nextPutAll(","),e.newLine(),e.nextPutAll("  "),e.newColumn(),t.addSemanticActionTemplate(i,r,e)}),e.newLine(),e.nextPutAll("}"),e.contents()},addSemanticActionTemplate:function(t,e,n){t.indexOf("-")>=0?(n.nextPutAll("'"),n.nextPutAll(t),n.nextPutAll("'")):n.nextPutAll(t),n.nextPutAll(": "),n.newColumn(),n.nextPutAll("function("),n.nextPutAll(this.semanticActionArgNames(t).join(", ")),n.nextPutAll(") "),n.newColumn(),n.nextPutAll("{");var i=e.getBindingNames();i.length>0&&(n.nextPutAll(" /* "),n.nextPutAll(i.join(", ")),n.nextPutAll(" */ ")),n.nextPutAll("}")}},RuleDecl.prototype={performChecks:abstract,performCommonChecks:function(t,e){e.assertNoDuplicateBindings(t),e.assertChoicesHaveUniformBindings(t)},install:function(t){t[this.name]=this.body},outputRecipe:function(t){t.nextPutAll("b."),t.nextPutAll(this.kind),t.nextPutAll("("),t.nextPutAll(stringUtils.printString(this.name)),t.nextPutAll(", "),this.body.outputRecipe(t),t.nextPutAll(")")}},Define.prototype=objectUtils.objectThatDelegatesTo(RuleDecl.prototype,{kind:"define",performChecks:function(){this.superGrammar.ruleDict[this.name]&&browser.error("cannot define rule",this.name,"because it already exists in the super-grammar.","(try override or extend instead.)"),this.performCommonChecks(this.name,this.body)}}),Override.prototype=objectUtils.objectThatDelegatesTo(RuleDecl.prototype,{kind:"override",performChecks:function(){var t=this.superGrammar.ruleDict[this.name];t||browser.error("cannot override rule",this.name,"because it does not exist in the super-grammar.","(try define instead.)"),0===t.getBindingNames().length&&t.producesValue()&&!this.body.producesValue()&&browser.error("the body of rule",this.name,"must produce a value, because the rule it's overriding also produces a value"),this.performCommonChecks(this.name,this.body)}}),Inline.prototype=objectUtils.objectThatDelegatesTo(RuleDecl.prototype,{kind:"inline",performChecks:function(){this.superGrammar.ruleDict[this.name]&&browser.error("cannot define inline rule",this.name,"because it already exists in the super-grammar."),this.performCommonChecks(this.name,this.body)}}),Extend.prototype=objectUtils.objectThatDelegatesTo(RuleDecl.prototype,{kind:"extend",performChecks:function(){var t=this.superGrammar.ruleDict[this.name];t||browser.error("cannot extend rule",this.name,"because it does not exist in the super-grammar.","(try define instead.)"),0===t.getBindingNames().length&&t.producesValue()&&!this.body.producesValue()&&browser.error("the body of rule",this.name,"must produce a value, because the rule it's extending also produces a value"),this.performCommonChecks(this.name,this.expandedBody)},install:function(t){t[this.name]=this.expandedBody}}),Builder.prototype={init:function(){this.name=void 0,this.superGrammar=Grammar.prototype,this.ruleDecls=[]},setName:function(t){this.name=t},setSuperGrammar:function(t){this.superGrammar=t},define:function(t,e){this.ruleDecls.push(new Define(t,e,this.superGrammar))},override:function(t,e){this.ruleDecls.push(new Override(t,e,this.superGrammar))},inline:function(t,e){return this.ruleDecls.push(new Inline(t,e,this.superGrammar)),this.app(t)},extend:function(t,e){this.ruleDecls.push(new Extend(t,e,this.superGrammar))},build:function(t){var e=this.superGrammar,n=objectUtils.objectThatDelegatesTo(e.ruleDict);this.ruleDecls.forEach(function(t){t.performChecks(),t.install(n)});var i=new Grammar(n);return i.superGrammar=e,i.ruleDecls=this.ruleDecls,this.name&&(i.name=this.name,t&&(i.namespaceName=t.name,t.install(this.name,i))),this.init(),i},_:function(t){return Prim.newFor(t)},alt:function(){for(var t=[],e=0;e<arguments.length;e++){var n=arguments[e];n instanceof Alt?t=t.concat(n.terms):t.push(n)}return 1===t.length?t[0]:new Alt(t)},seq:function(){for(var t=[],e=0;e<arguments.length;e++){var n=arguments[e];n instanceof Seq?t=t.concat(n.factors):t.push(n)}return 1===t.length?t[0]:new Seq(t)},bind:function(t,e){return new Bind(t,e)},many:function(t,e){return new Many(t,e)},opt:function(t){return new Opt(t)},not:function(t){return new Not(t)},la:function(t){return new Lookahead(t)},str:function(t){return new Str(t)},lst:function(t){return new List(t)},obj:function(t,e){return new Obj(t,!!e)},app:function(t){return new Apply(t)}};var namespaces={};Namespace.prototype={install:function(t,e){return this.grammars[t]?browser.error("duplicate declaration of grammar",t,"in namespace",this.name):this.grammars[t]=e,this},getGrammar:function(t){return this.grammars[t]||browser.error("ohm namespace",this.name,"has no grammar called",t)},loadGrammarsFromScriptElement:function(t){return browser.sanityCheck('script tag\'s type attribute must be "text/ohm-js"',"text/ohm-js"===t.type),makeGrammars(t.innerHTML,this),this}},thisModule.namespace=function(t){return void 0===namespaces[t]&&(namespaces[t]=new Namespace(t)),namespaces[t]},thisModule.makeGrammar=makeGrammar,thisModule.makeGrammars=makeGrammars,thisModule.builder=function(){return new Builder},thisModule._makeGrammarActionDict=makeGrammarActionDict;var ohmGrammar;Object.defineProperty(thisModule,"_ohmGrammar",{get:function(){return ohmGrammar||(ohmGrammar=this._ohmGrammarFactory(this)),ohmGrammar}});
},{"../dist/ohm-grammar.js":1,"awlib":2}]},{},[7])
(7)
});