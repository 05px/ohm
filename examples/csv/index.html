<!doctype html>
<html>
  <head>
    <title>ohm/js csv demo</title>
    <meta charset=utf-8>
    <script src="../lib.js"></script>
    <script src="../../dist/ohm.js"></script>
    <script type="text/ohm-js">

CSV {
  csv = row (eol ~end row)* eol?
  row = col ("," col)*
  col = colChar*
  colChar = ~(eol | ",") _
  eol = "\r"? "\n"
}

    </script>
  </head>
  <body>
    <output style="white-space: pre; font-family: 'courier new';" id="output"></output>
    <script>

var g = ohm.grammarFromScriptElement();
var s = g.semantics().addOperation('value', {
  csv:   function(r, _, rs, _) { return [r.value()].concat(rs.value()); },
  row:   function(c, _, cs)    { return [c.value()].concat(cs.value()); },
  col:   function(_)           { return this.interval.contents; },
  _many: ohm.actions.makeArray
});

var someInput = 
    'foo,bar,baz\n' +
    'foo,bar\n' +
    '\n' +
    'foo,,baz\n' +
    ',bar,baz\n' +
    'foo';

function showWhatHappensTo(input) {
  var m = g.match(input);
  var v = s(m).value();
  print(JSON.stringify(input) + '\n => ' + JSON.stringify(v) + '\n\n');
}

function print(x) {
  var t = document.createTextNode(x);
  output.appendChild(t);
}

showWhatHappensTo(someInput);
// => [["foo","bar","baz"],["foo","bar"],[""],["foo","","baz"],["","bar","baz"],["foo"]]

showWhatHappensTo(someInput + '\n');
// => [["foo","bar","baz"],["foo","bar"],[""],["foo","","baz"],["","bar","baz"],["foo"]]

    </script>
  </body>
</html>
